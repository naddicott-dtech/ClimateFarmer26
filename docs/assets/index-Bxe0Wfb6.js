(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();var Ve,k,hn,_n,ae,It,vn,mn,yn,bt,lt,ct,Oe={},Fe=[],fo=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,qe=Array.isArray;function z(e,t){for(var n in t)e[n]=t[n];return e}function wt(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function po(e,t,n){var o,r,a,i={};for(a in t)a=="key"?o=t[a]:a=="ref"?r=t[a]:i[a]=t[a];if(arguments.length>2&&(i.children=arguments.length>3?Ve.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(a in e.defaultProps)i[a]===void 0&&(i[a]=e.defaultProps[a]);return Ie(e,i,o,r,null)}function Ie(e,t,n,o,r){var a={type:e,props:t,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r??++hn,__i:-1,__u:0};return r==null&&k.vnode!=null&&k.vnode(a),a}function ee(e){return e.children}function Se(e,t){this.props=e,this.context=t}function he(e,t){if(t==null)return e.__?he(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?he(e):null}function ho(e){if(e.__P&&e.__d){var t=e.__v,n=t.__e,o=[],r=[],a=z({},t);a.__v=t.__v+1,k.vnode&&k.vnode(a),Ct(e.__P,a,t,e.__n,e.__P.namespaceURI,32&t.__u?[n]:null,o,n??he(t),!!(32&t.__u),r),a.__v=t.__v,a.__.__k[a.__i]=a,Cn(o,a,r),t.__e=t.__=null,a.__e!=n&&gn(a)}}function gn(e){if((e=e.__)!=null&&e.__c!=null)return e.__e=e.__c.base=null,e.__k.some(function(t){if(t!=null&&t.__e!=null)return e.__e=e.__c.base=t.__e}),gn(e)}function Bt(e){(!e.__d&&(e.__d=!0)&&ae.push(e)&&!He.__r++||It!=k.debounceRendering)&&((It=k.debounceRendering)||vn)(He)}function He(){for(var e,t=1;ae.length;)ae.length>t&&ae.sort(mn),e=ae.shift(),t=ae.length,ho(e);He.__r=0}function bn(e,t,n,o,r,a,i,s,d,c,f){var u,p,v,b,S,w,g,m=o&&o.__k||Fe,I=t.length;for(d=_o(n,t,m,d,I),u=0;u<I;u++)(v=n.__k[u])!=null&&(p=v.__i!=-1&&m[v.__i]||Oe,v.__i=u,w=Ct(e,v,p,r,a,i,s,d,c,f),b=v.__e,v.ref&&p.ref!=v.ref&&(p.ref&&St(p.ref,null,v),f.push(v.ref,v.__c||b,v)),S==null&&b!=null&&(S=b),(g=!!(4&v.__u))||p.__k===v.__k?d=wn(v,d,e,g):typeof v.type=="function"&&w!==void 0?d=w:b&&(d=b.nextSibling),v.__u&=-7);return n.__e=S,d}function _o(e,t,n,o,r){var a,i,s,d,c,f=n.length,u=f,p=0;for(e.__k=new Array(r),a=0;a<r;a++)(i=t[a])!=null&&typeof i!="boolean"&&typeof i!="function"?(typeof i=="string"||typeof i=="number"||typeof i=="bigint"||i.constructor==String?i=e.__k[a]=Ie(null,i,null,null,null):qe(i)?i=e.__k[a]=Ie(ee,{children:i},null,null,null):i.constructor===void 0&&i.__b>0?i=e.__k[a]=Ie(i.type,i.props,i.key,i.ref?i.ref:null,i.__v):e.__k[a]=i,d=a+p,i.__=e,i.__b=e.__b+1,s=null,(c=i.__i=vo(i,n,d,u))!=-1&&(u--,(s=n[c])&&(s.__u|=2)),s==null||s.__v==null?(c==-1&&(r>f?p--:r<f&&p++),typeof i.type!="function"&&(i.__u|=4)):c!=d&&(c==d-1?p--:c==d+1?p++:(c>d?p--:p++,i.__u|=4))):e.__k[a]=null;if(u)for(a=0;a<f;a++)(s=n[a])!=null&&(2&s.__u)==0&&(s.__e==o&&(o=he(s)),$n(s,s));return o}function wn(e,t,n,o){var r,a;if(typeof e.type=="function"){for(r=e.__k,a=0;r&&a<r.length;a++)r[a]&&(r[a].__=e,t=wn(r[a],t,n,o));return t}e.__e!=t&&(o&&(t&&e.type&&!t.parentNode&&(t=he(e)),n.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function vo(e,t,n,o){var r,a,i,s=e.key,d=e.type,c=t[n],f=c!=null&&(2&c.__u)==0;if(c===null&&s==null||f&&s==c.key&&d==c.type)return n;if(o>(f?1:0)){for(r=n-1,a=n+1;r>=0||a<t.length;)if((c=t[i=r>=0?r--:a++])!=null&&(2&c.__u)==0&&s==c.key&&d==c.type)return i}return-1}function Lt(e,t,n){t[0]=="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||fo.test(t)?n:n+"px"}function Re(e,t,n,o,r){var a,i;e:if(t=="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof o=="string"&&(e.style.cssText=o=""),o)for(t in o)n&&t in n||Lt(e.style,t,"");if(n)for(t in n)o&&n[t]==o[t]||Lt(e.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")a=t!=(t=t.replace(yn,"$1")),i=t.toLowerCase(),t=i in e||t=="onFocusOut"||t=="onFocusIn"?i.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+a]=n,n?o?n.u=o.u:(n.u=bt,e.addEventListener(t,a?ct:lt,a)):e.removeEventListener(t,a?ct:lt,a);else{if(r=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&n==1?"":n))}}function Nt(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=bt++;else if(t.t<n.u)return;return n(k.event?k.event(t):t)}}}function Ct(e,t,n,o,r,a,i,s,d,c){var f,u,p,v,b,S,w,g,m,I,W,oe,Te,L,q,F=t.type;if(t.constructor!==void 0)return null;128&n.__u&&(d=!!(32&n.__u),a=[s=t.__e=n.__e]),(f=k.__b)&&f(t);e:if(typeof F=="function")try{if(g=t.props,m="prototype"in F&&F.prototype.render,I=(f=F.contextType)&&o[f.__c],W=f?I?I.props.value:f.__:o,n.__c?w=(u=t.__c=n.__c).__=u.__E:(m?t.__c=u=new F(g,W):(t.__c=u=new Se(g,W),u.constructor=F,u.render=yo),I&&I.sub(u),u.state||(u.state={}),u.__n=o,p=u.__d=!0,u.__h=[],u._sb=[]),m&&u.__s==null&&(u.__s=u.state),m&&F.getDerivedStateFromProps!=null&&(u.__s==u.state&&(u.__s=z({},u.__s)),z(u.__s,F.getDerivedStateFromProps(g,u.__s))),v=u.props,b=u.state,u.__v=t,p)m&&F.getDerivedStateFromProps==null&&u.componentWillMount!=null&&u.componentWillMount(),m&&u.componentDidMount!=null&&u.__h.push(u.componentDidMount);else{if(m&&F.getDerivedStateFromProps==null&&g!==v&&u.componentWillReceiveProps!=null&&u.componentWillReceiveProps(g,W),t.__v==n.__v||!u.__e&&u.shouldComponentUpdate!=null&&u.shouldComponentUpdate(g,u.__s,W)===!1){t.__v!=n.__v&&(u.props=g,u.state=u.__s,u.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(fe){fe&&(fe.__=t)}),Fe.push.apply(u.__h,u._sb),u._sb=[],u.__h.length&&i.push(u);break e}u.componentWillUpdate!=null&&u.componentWillUpdate(g,u.__s,W),m&&u.componentDidUpdate!=null&&u.__h.push(function(){u.componentDidUpdate(v,b,S)})}if(u.context=W,u.props=g,u.__P=e,u.__e=!1,oe=k.__r,Te=0,m)u.state=u.__s,u.__d=!1,oe&&oe(t),f=u.render(u.props,u.state,u.context),Fe.push.apply(u.__h,u._sb),u._sb=[];else do u.__d=!1,oe&&oe(t),f=u.render(u.props,u.state,u.context),u.state=u.__s;while(u.__d&&++Te<25);u.state=u.__s,u.getChildContext!=null&&(o=z(z({},o),u.getChildContext())),m&&!p&&u.getSnapshotBeforeUpdate!=null&&(S=u.getSnapshotBeforeUpdate(v,b)),L=f!=null&&f.type===ee&&f.key==null?Sn(f.props.children):f,s=bn(e,qe(L)?L:[L],t,n,o,r,a,i,s,d,c),u.base=t.__e,t.__u&=-161,u.__h.length&&i.push(u),w&&(u.__E=u.__=null)}catch(fe){if(t.__v=null,d||a!=null)if(fe.then){for(t.__u|=d?160:128;s&&s.nodeType==8&&s.nextSibling;)s=s.nextSibling;a[a.indexOf(s)]=null,t.__e=s}else{for(q=a.length;q--;)wt(a[q]);ut(t)}else t.__e=n.__e,t.__k=n.__k,fe.then||ut(t);k.__e(fe,t,n)}else a==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):s=t.__e=mo(n.__e,t,n,o,r,a,i,d,c);return(f=k.diffed)&&f(t),128&t.__u?void 0:s}function ut(e){e&&(e.__c&&(e.__c.__e=!0),e.__k&&e.__k.some(ut))}function Cn(e,t,n){for(var o=0;o<n.length;o++)St(n[o],n[++o],n[++o]);k.__c&&k.__c(t,e),e.some(function(r){try{e=r.__h,r.__h=[],e.some(function(a){a.call(r)})}catch(a){k.__e(a,r.__v)}})}function Sn(e){return typeof e!="object"||e==null||e.__b>0?e:qe(e)?e.map(Sn):z({},e)}function mo(e,t,n,o,r,a,i,s,d){var c,f,u,p,v,b,S,w=n.props||Oe,g=t.props,m=t.type;if(m=="svg"?r="http://www.w3.org/2000/svg":m=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),a!=null){for(c=0;c<a.length;c++)if((v=a[c])&&"setAttribute"in v==!!m&&(m?v.localName==m:v.nodeType==3)){e=v,a[c]=null;break}}if(e==null){if(m==null)return document.createTextNode(g);e=document.createElementNS(r,m,g.is&&g),s&&(k.__m&&k.__m(t,a),s=!1),a=null}if(m==null)w===g||s&&e.data==g||(e.data=g);else{if(a=a&&Ve.call(e.childNodes),!s&&a!=null)for(w={},c=0;c<e.attributes.length;c++)w[(v=e.attributes[c]).name]=v.value;for(c in w)v=w[c],c=="dangerouslySetInnerHTML"?u=v:c=="children"||c in g||c=="value"&&"defaultValue"in g||c=="checked"&&"defaultChecked"in g||Re(e,c,null,v,r);for(c in g)v=g[c],c=="children"?p=v:c=="dangerouslySetInnerHTML"?f=v:c=="value"?b=v:c=="checked"?S=v:s&&typeof v!="function"||w[c]===v||Re(e,c,v,w[c],r);if(f)s||u&&(f.__html==u.__html||f.__html==e.innerHTML)||(e.innerHTML=f.__html),t.__k=[];else if(u&&(e.innerHTML=""),bn(t.type=="template"?e.content:e,qe(p)?p:[p],t,n,o,m=="foreignObject"?"http://www.w3.org/1999/xhtml":r,a,i,a?a[0]:n.__k&&he(n,0),s,d),a!=null)for(c=a.length;c--;)wt(a[c]);s||(c="value",m=="progress"&&b==null?e.removeAttribute("value"):b!=null&&(b!==e[c]||m=="progress"&&!b||m=="option"&&b!=w[c])&&Re(e,c,b,w[c],r),c="checked",S!=null&&S!=e[c]&&Re(e,c,S,w[c],r))}return e}function St(e,t,n){try{if(typeof e=="function"){var o=typeof e.__u=="function";o&&e.__u(),o&&t==null||(e.__u=e(t))}else e.current=t}catch(r){k.__e(r,n)}}function $n(e,t,n){var o,r;if(k.unmount&&k.unmount(e),(o=e.ref)&&(o.current&&o.current!=e.__e||St(o,null,t)),(o=e.__c)!=null){if(o.componentWillUnmount)try{o.componentWillUnmount()}catch(a){k.__e(a,t)}o.base=o.__P=null}if(o=e.__k)for(r=0;r<o.length;r++)o[r]&&$n(o[r],t,n||typeof e.type!="function");n||wt(e.__e),e.__c=e.__=e.__e=void 0}function yo(e,t,n){return this.constructor(e,n)}function go(e,t,n){var o,r,a,i;t==document&&(t=document.documentElement),k.__&&k.__(e,t),r=(o=!1)?null:t.__k,a=[],i=[],Ct(t,e=t.__k=po(ee,null,[e]),r||Oe,Oe,t.namespaceURI,r?null:t.firstChild?Ve.call(t.childNodes):null,a,r?r.__e:t.firstChild,o,i),Cn(a,e,i)}Ve=Fe.slice,k={__e:function(e,t,n,o){for(var r,a,i;t=t.__;)if((r=t.__c)&&!r.__)try{if((a=r.constructor)&&a.getDerivedStateFromError!=null&&(r.setState(a.getDerivedStateFromError(e)),i=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(e,o||{}),i=r.__d),i)return r.__E=r}catch(s){e=s}throw e}},hn=0,_n=function(e){return e!=null&&e.constructor===void 0},Se.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=z({},this.state),typeof e=="function"&&(e=e(z({},n),this.props)),e&&z(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),Bt(this))},Se.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Bt(this))},Se.prototype.render=ee,ae=[],vn=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,mn=function(e,t){return e.__v.__b-t.__v.__b},He.__r=0,yn=/(PointerCapture)$|Capture$/i,bt=0,lt=Nt(!1),ct=Nt(!0);var bo=0;function l(e,t,n,o,r,a){t||(t={});var i,s,d=t;if("ref"in d)for(s in d={},t)s=="ref"?i=t[s]:d[s]=t[s];var c={type:e,props:d,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--bo,__i:-1,__u:0,__source:r,__self:a};if(typeof e=="function"&&(i=e.defaultProps))for(s in i)d[s]===void 0&&(d[s]=i[s]);return k.vnode&&k.vnode(c),c}var Pe,M,et,Ot,ke=0,Dn=[],x=k,Ft=x.__b,Ht=x.__r,Wt=x.diffed,Ut=x.__c,Yt=x.unmount,jt=x.__;function $t(e,t){x.__h&&x.__h(M,e,ke||t),ke=0;var n=M.__H||(M.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function we(e){return ke=1,wo(kn,e)}function wo(e,t,n){var o=$t(Pe++,2);if(o.t=e,!o.__c&&(o.__=[kn(void 0,t),function(s){var d=o.__N?o.__N[0]:o.__[0],c=o.t(d,s);d!==c&&(o.__N=[c,o.__[1]],o.__c.setState({}))}],o.__c=M,!M.__f)){var r=function(s,d,c){if(!o.__c.__H)return!0;var f=o.__c.__H.__.filter(function(p){return p.__c});if(f.every(function(p){return!p.__N}))return!a||a.call(this,s,d,c);var u=o.__c.props!==s;return f.some(function(p){if(p.__N){var v=p.__[0];p.__=p.__N,p.__N=void 0,v!==p.__[0]&&(u=!0)}}),a&&a.call(this,s,d,c)||u};M.__f=!0;var a=M.shouldComponentUpdate,i=M.componentWillUpdate;M.componentWillUpdate=function(s,d,c){if(this.__e){var f=a;a=void 0,r(s,d,c),a=f}i&&i.call(this,s,d,c)},M.shouldComponentUpdate=r}return o.__N||o.__}function J(e,t){var n=$t(Pe++,3);!x.__s&&Pn(n.__H,t)&&(n.__=e,n.u=t,M.__H.__h.push(n))}function se(e){return ke=5,Ke(function(){return{current:e}},[])}function Ke(e,t){var n=$t(Pe++,7);return Pn(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function Co(e,t){return ke=8,Ke(function(){return e},t)}function So(){for(var e;e=Dn.shift();){var t=e.__H;if(e.__P&&t)try{t.__h.some(Be),t.__h.some(dt),t.__h=[]}catch(n){t.__h=[],x.__e(n,e.__v)}}}x.__b=function(e){M=null,Ft&&Ft(e)},x.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),jt&&jt(e,t)},x.__r=function(e){Ht&&Ht(e),Pe=0;var t=(M=e.__c).__H;t&&(et===M?(t.__h=[],M.__h=[],t.__.some(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.some(Be),t.__h.some(dt),t.__h=[],Pe=0)),et=M},x.diffed=function(e){Wt&&Wt(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(Dn.push(t)!==1&&Ot===x.requestAnimationFrame||((Ot=x.requestAnimationFrame)||$o)(So)),t.__H.__.some(function(n){n.u&&(n.__H=n.u),n.u=void 0})),et=M=null},x.__c=function(e,t){t.some(function(n){try{n.__h.some(Be),n.__h=n.__h.filter(function(o){return!o.__||dt(o)})}catch(o){t.some(function(r){r.__h&&(r.__h=[])}),t=[],x.__e(o,n.__v)}}),Ut&&Ut(e,t)},x.unmount=function(e){Yt&&Yt(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.some(function(o){try{Be(o)}catch(r){t=r}}),n.__H=void 0,t&&x.__e(t,n.__v))};var Gt=typeof requestAnimationFrame=="function";function $o(e){var t,n=function(){clearTimeout(o),Gt&&cancelAnimationFrame(t),setTimeout(e)},o=setTimeout(n,35);Gt&&(t=requestAnimationFrame(n))}function Be(e){var t=M,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),M=t}function dt(e){var t=M;e.__c=e.__(),M=t}function Pn(e,t){return!e||e.length!==t.length||t.some(function(n,o){return n!==e[o]})}function kn(e,t){return typeof t=="function"?t(e):t}var Do=Symbol.for("preact-signals");function ze(){if(te>1)te--;else{for(var e,t=!1;$e!==void 0;){var n=$e;for($e=void 0,ft++;n!==void 0;){var o=n.o;if(n.o=void 0,n.f&=-3,!(8&n.f)&&Rn(n))try{n.c()}catch(r){t||(e=r,t=!0)}n=o}}if(ft=0,te--,t)throw e}}function _e(e){if(te>0)return e();te++;try{return e()}finally{ze()}}var $=void 0;function En(e){var t=$;$=void 0;try{return e()}finally{$=t}}var $e=void 0,te=0,ft=0,We=0;function Tn(e){if($!==void 0){var t=e.n;if(t===void 0||t.t!==$)return t={i:0,S:e,p:$.s,n:void 0,t:$,e:void 0,x:void 0,r:t},$.s!==void 0&&($.s.n=t),$.s=t,e.n=t,32&$.f&&e.S(t),t;if(t.i===-1)return t.i=0,t.n!==void 0&&(t.n.p=t.p,t.p!==void 0&&(t.p.n=t.n),t.p=$.s,t.n=void 0,$.s.n=t,$.s=t),t}}function B(e,t){this.v=e,this.i=0,this.n=void 0,this.t=void 0,this.W=t?.watched,this.Z=t?.unwatched,this.name=t?.name}B.prototype.brand=Do;B.prototype.h=function(){return!0};B.prototype.S=function(e){var t=this,n=this.t;n!==e&&e.e===void 0&&(e.x=n,this.t=e,n!==void 0?n.e=e:En(function(){var o;(o=t.W)==null||o.call(t)}))};B.prototype.U=function(e){var t=this;if(this.t!==void 0){var n=e.e,o=e.x;n!==void 0&&(n.x=o,e.e=void 0),o!==void 0&&(o.e=n,e.x=void 0),e===this.t&&(this.t=o,o===void 0&&En(function(){var r;(r=t.Z)==null||r.call(t)}))}};B.prototype.subscribe=function(e){var t=this;return Pt(function(){var n=t.value,o=$;$=void 0;try{e(n)}finally{$=o}},{name:"sub"})};B.prototype.valueOf=function(){return this.value};B.prototype.toString=function(){return this.value+""};B.prototype.toJSON=function(){return this.value};B.prototype.peek=function(){var e=$;$=void 0;try{return this.value}finally{$=e}};Object.defineProperty(B.prototype,"value",{get:function(){var e=Tn(this);return e!==void 0&&(e.i=this.i),this.v},set:function(e){if(e!==this.v){if(ft>100)throw new Error("Cycle detected");this.v=e,this.i++,We++,te++;try{for(var t=this.t;t!==void 0;t=t.x)t.t.N()}finally{ze()}}}});function V(e,t){return new B(e,t)}function Rn(e){for(var t=e.s;t!==void 0;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function An(e){for(var t=e.s;t!==void 0;t=t.n){var n=t.S.n;if(n!==void 0&&(t.r=n),t.S.n=t,t.i=-1,t.n===void 0){e.s=t;break}}}function Mn(e){for(var t=e.s,n=void 0;t!==void 0;){var o=t.p;t.i===-1?(t.S.U(t),o!==void 0&&(o.n=t.n),t.n!==void 0&&(t.n.p=o)):n=t,t.S.n=t.r,t.r!==void 0&&(t.r=void 0),t=o}e.s=n}function ue(e,t){B.call(this,void 0),this.x=e,this.s=void 0,this.g=We-1,this.f=4,this.W=t?.watched,this.Z=t?.unwatched,this.name=t?.name}ue.prototype=new B;ue.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===We))return!0;if(this.g=We,this.f|=1,this.i>0&&!Rn(this))return this.f&=-2,!0;var e=$;try{An(this),$=this;var t=this.x();(16&this.f||this.v!==t||this.i===0)&&(this.v=t,this.f&=-17,this.i++)}catch(n){this.v=n,this.f|=16,this.i++}return $=e,Mn(this),this.f&=-2,!0};ue.prototype.S=function(e){if(this.t===void 0){this.f|=36;for(var t=this.s;t!==void 0;t=t.n)t.S.S(t)}B.prototype.S.call(this,e)};ue.prototype.U=function(e){if(this.t!==void 0&&(B.prototype.U.call(this,e),this.t===void 0)){this.f&=-33;for(var t=this.s;t!==void 0;t=t.n)t.S.U(t)}};ue.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var e=this.t;e!==void 0;e=e.x)e.t.N()}};Object.defineProperty(ue.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var e=Tn(this);if(this.h(),e!==void 0&&(e.i=this.i),16&this.f)throw this.v;return this.v}});function H(e,t){return new ue(e,t)}function xn(e){var t=e.u;if(e.u=void 0,typeof t=="function"){te++;var n=$;$=void 0;try{t()}catch(o){throw e.f&=-2,e.f|=8,Dt(e),o}finally{$=n,ze()}}}function Dt(e){for(var t=e.s;t!==void 0;t=t.n)t.S.U(t);e.x=void 0,e.s=void 0,xn(e)}function Po(e){if($!==this)throw new Error("Out-of-order effect");Mn(this),$=e,this.f&=-2,8&this.f&&Dt(this),ze()}function ye(e,t){this.x=e,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32,this.name=t?.name}ye.prototype.c=function(){var e=this.S();try{if(8&this.f||this.x===void 0)return;var t=this.x();typeof t=="function"&&(this.u=t)}finally{e()}};ye.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,xn(this),An(this),te++;var e=$;return $=this,Po.bind(this,e)};ye.prototype.N=function(){2&this.f||(this.f|=2,this.o=$e,$e=this)};ye.prototype.d=function(){this.f|=8,1&this.f||Dt(this)};ye.prototype.dispose=function(){this.d()};function Pt(e,t){var n=new ye(e,t);try{n.c()}catch(r){throw n.d(),r}var o=n.d.bind(n);return o[Symbol.dispose]=o,o}var Ae;function ge(e,t){k[e]=t.bind(null,k[e]||function(){})}function Ue(e){if(Ae){var t=Ae;Ae=void 0,t()}Ae=e&&e.S()}function In(e){var t=this,n=e.data,o=Eo(n);o.value=n;var r=Ke(function(){for(var a=t.__v;a=a.__;)if(a.__c){a.__c.__$f|=4;break}return t.__$u.c=function(){var i,s=t.__$u.S(),d=r.value;s(),_n(d)||((i=t.base)==null?void 0:i.nodeType)!==3?(t.__$f|=1,t.setState({})):t.base.data=d},H(function(){var i=o.value.value;return i===0?0:i===!0?"":i||""})},[]);return r.value}In.displayName="_st";Object.defineProperties(B.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:In},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}});ge("__b",function(e,t){if(typeof t.type=="string"){var n,o=t.props;for(var r in o)if(r!=="children"){var a=o[r];a instanceof B&&(n||(t.__np=n={}),n[r]=a,o[r]=a.peek())}}e(t)});ge("__r",function(e,t){e(t),Ue();var n,o=t.__c;o&&(o.__$f&=-2,(n=o.__$u)===void 0&&(o.__$u=n=(function(r){var a;return Pt(function(){a=this}),a.c=function(){o.__$f|=1,o.setState({})},a})())),Ue(n)});ge("__e",function(e,t,n,o){Ue(),e(t,n,o)});ge("diffed",function(e,t){Ue();var n;if(typeof t.type=="string"&&(n=t.__e)){var o=t.__np,r=t.props;if(o){var a=n.U;if(a)for(var i in a){var s=a[i];s!==void 0&&!(i in o)&&(s.d(),a[i]=void 0)}else n.U=a={};for(var d in o){var c=a[d],f=o[d];c===void 0?(c=ko(n,d,f,r),a[d]=c):c.o(f,r)}}}e(t)});function ko(e,t,n,o){var r=t in e&&e.ownerSVGElement===void 0,a=V(n);return{o:function(i,s){a.value=i,o=s},d:Pt(function(){var i=a.value.value;o[t]!==i&&(o[t]=i,r?e[t]=i:i?e.setAttribute(t,i):e.removeAttribute(t))})}}ge("unmount",function(e,t){if(typeof t.type=="string"){var n=t.__e;if(n){var o=n.U;if(o){n.U=void 0;for(var r in o){var a=o[r];a&&a.d()}}}}else{var i=t.__c;if(i){var s=i.__$u;s&&(i.__$u=void 0,s.d())}}e(t)});ge("__h",function(e,t,n,o){(o<3||o===9)&&(t.__$f|=2),e(t,n,o)});Se.prototype.shouldComponentUpdate=function(e,t){if(this.__R)return!0;var n=this.__$u,o=n&&n.s!==void 0;for(var r in t)return!0;if(this.__f||typeof this.u=="boolean"&&this.u===!0){if(!(o||2&this.__$f||4&this.__$f)||1&this.__$f)return!0}else if(!(o||4&this.__$f)||3&this.__$f)return!0;for(var a in e)if(a!=="__source"&&e[a]!==this.props[a])return!0;for(var i in this.props)if(!(i in e))return!0;return!1};function Eo(e){return Ke(function(){return V(e)},[])}const Vt={bankruptcy:100,year_30:100,loan_offer:95,event:85,advisor:82,harvest_ready:80,water_stress:60,year_end:40},D=8,C=8,To=30,le=365,kt=30,Ro=5e4,Ao=100,Mo=2,xo=4,Bn=6,Ln=.8,Io=.25,Bo=.3,Lo=.15,No=80,Oo=40,Qe=5,Fo=3,qt=59,Nn="4.0.0",Ho=90,Kt=.1,Wo=.2,zt=1e5,On=1e4;class Ye{state;constructor(t){this.state=t|0}next(){this.state=this.state+1831565813|0;let t=Math.imul(this.state^this.state>>>15,1|this.state);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}nextInt(t,n){return Math.floor(this.next()*(n-t+1))+t}chance(t){return this.next()<t}getState(){return this.state}setState(t){this.state=t|0}}const pt={"processing-tomatoes":{id:"processing-tomatoes",name:"Processing Tomatoes",type:"annual",gddBase:50,gddToMaturity:2500,plantingWindow:{startMonth:3,endMonth:5},waterUsePerDay:.25,cropCoefficients:[{stage:"seedling",kc:.3},{stage:"vegetative",kc:.7},{stage:"flowering",kc:1.1},{stage:"mature",kc:.9},{stage:"harvestable",kc:.5},{stage:"overripe",kc:.3}],ky:1.05,nitrogenUptake:200,yieldPotential:45,yieldUnit:"tons",basePrice:80,seedCostPerAcre:150,laborCostPerAcre:200,shortDescription:"High-value warm-season crop. Heavy nitrogen feeder — depletes soil fast without rotation."},"silage-corn":{id:"silage-corn",name:"Silage Corn",type:"annual",gddBase:50,gddToMaturity:2700,plantingWindow:{startMonth:3,endMonth:5},waterUsePerDay:.22,cropCoefficients:[{stage:"seedling",kc:.3},{stage:"vegetative",kc:.8},{stage:"flowering",kc:1.15},{stage:"mature",kc:.85},{stage:"harvestable",kc:.4},{stage:"overripe",kc:.2}],ky:.9,nitrogenUptake:150,yieldPotential:30,yieldUnit:"tons",basePrice:55,seedCostPerAcre:100,laborCostPerAcre:80,shortDescription:"Reliable feed crop. Moderate water and nitrogen needs. Good rotation partner for tomatoes."},"winter-wheat":{id:"winter-wheat",name:"Winter Wheat",type:"annual",gddBase:40,gddToMaturity:2e3,plantingWindow:{startMonth:10,endMonth:11},waterUsePerDay:.15,cropCoefficients:[{stage:"seedling",kc:.3},{stage:"vegetative",kc:.6},{stage:"flowering",kc:1},{stage:"mature",kc:.7},{stage:"harvestable",kc:.3},{stage:"overripe",kc:.15}],ky:.65,nitrogenUptake:80,yieldPotential:80,yieldUnit:"bu",basePrice:7,seedCostPerAcre:50,laborCostPerAcre:40,shortDescription:"Cool-season grain. Low water needs, light on soil. Plant in fall, harvest in spring."},sorghum:{id:"sorghum",name:"Sorghum",type:"annual",gddBase:50,gddToMaturity:2200,plantingWindow:{startMonth:4,endMonth:6},waterUsePerDay:.15,cropCoefficients:[{stage:"seedling",kc:.3},{stage:"vegetative",kc:.6},{stage:"flowering",kc:.9},{stage:"mature",kc:.7},{stage:"harvestable",kc:.35},{stage:"overripe",kc:.2}],ky:.5,nitrogenUptake:80,yieldPotential:110,yieldUnit:"bu",basePrice:6,seedCostPerAcre:35,laborCostPerAcre:45,shortDescription:"Drought-tolerant warm-season grain. Low profit but survives conditions that kill corn and tomatoes."},almonds:{id:"almonds",name:"Almonds",type:"perennial",gddBase:50,gddToMaturity:3e3,plantingWindow:{startMonth:1,endMonth:3},waterUsePerDay:.3,cropCoefficients:[{stage:"seedling",kc:.4},{stage:"vegetative",kc:.7},{stage:"flowering",kc:1},{stage:"mature",kc:.9},{stage:"harvestable",kc:.5},{stage:"overripe",kc:.3}],ky:.9,nitrogenUptake:120,yieldPotential:2500,yieldUnit:"lbs",basePrice:2.5,seedCostPerAcre:960,laborCostPerAcre:300,yearsToEstablish:3,removalCost:500,annualMaintenanceCost:200,dormantSeasons:["winter"],productiveLifespan:22,chillHoursRequired:700,yieldCurve:{rampUpYears:3,declineStartYear:15,endOfLifeYear:22,declineFloor:.2},shortDescription:"Perennial tree crop. High establishment cost, no revenue for 3 years, then strong annual income. Goes dormant in winter."},pistachios:{id:"pistachios",name:"Pistachios",type:"perennial",gddBase:50,gddToMaturity:2800,plantingWindow:{startMonth:1,endMonth:3},waterUsePerDay:.28,cropCoefficients:[{stage:"seedling",kc:.35},{stage:"vegetative",kc:.65},{stage:"flowering",kc:.95},{stage:"mature",kc:.85},{stage:"harvestable",kc:.45},{stage:"overripe",kc:.25}],ky:.7,nitrogenUptake:100,yieldPotential:2200,yieldUnit:"lbs",basePrice:2.8,seedCostPerAcre:900,laborCostPerAcre:280,yearsToEstablish:4,removalCost:450,annualMaintenanceCost:180,dormantSeasons:["winter"],productiveLifespan:25,chillHoursRequired:600,yieldCurve:{rampUpYears:3,declineStartYear:17,endOfLifeYear:25,declineFloor:.2},shortDescription:"Perennial tree crop. 4-year establishment, very drought-tolerant. Alternate bearing — reliable long-term investment."},"citrus-navels":{id:"citrus-navels",name:"Citrus Navels",type:"perennial",gddBase:55,gddToMaturity:2800,plantingWindow:{startMonth:2,endMonth:4},waterUsePerDay:.2,cropCoefficients:[{stage:"seedling",kc:.4},{stage:"vegetative",kc:.65},{stage:"flowering",kc:.85},{stage:"mature",kc:.75},{stage:"harvestable",kc:.5},{stage:"overripe",kc:.3}],ky:.8,nitrogenUptake:100,yieldPotential:350,yieldUnit:"boxes",basePrice:14,seedCostPerAcre:800,laborCostPerAcre:250,yearsToEstablish:3,removalCost:400,annualMaintenanceCost:150,productiveLifespan:35,yieldCurve:{rampUpYears:3,declineStartYear:28,endOfLifeYear:35,declineFloor:.3},shortDescription:"Evergreen perennial. Stable income, no chill-hour risk, never declines — but less profitable than almonds at peak."}};function R(e){const t=pt[e];if(!t)throw new Error(`Unknown crop ID: "${e}". Valid IDs: ${Object.keys(pt).join(", ")}`);return t}function Fn(){return Object.keys(pt)}function Qt(e,t,n){switch(e.type){case"min_year":return t.calendar.year>=e.year;case"max_year":return t.calendar.year<=e.year;case"season":return t.calendar.season===e.season;case"season_not":return t.calendar.season!==e.season;case"cash_below":return t.economy.cash<e.amount;case"cash_above":return t.economy.cash>e.amount;case"has_crop":{for(let o=0;o<D;o++)for(let r=0;r<C;r++){const a=t.grid[o][r].crop;if(a&&(!e.cropId||a.cropId===e.cropId))return!0}return!1}case"avg_nitrogen_below":{let o=0;for(let r=0;r<D;r++)for(let a=0;a<C;a++)o+=t.grid[r][a].soil.nitrogen;return o/(D*C)<e.level}case"any_perennial_planted":{for(let o=0;o<D;o++)for(let r=0;r<C;r++){const a=t.grid[o][r].crop;if(a&&a.isPerennial)return!0}return!1}case"no_perennial_planted":{for(let o=0;o<D;o++)for(let r=0;r<C;r++){const a=t.grid[o][r].crop;if(a&&a.isPerennial)return!1}return!0}case"consecutive_crop_failures":return t.cropFailureStreak>=e.count;case"no_debt":return t.economy.debt===0;case"has_flag":return t.flags[e.flag]===!0;case"has_declining_perennial":{for(let o=0;o<D;o++)for(let r=0;r<C;r++){const a=t.grid[o][r].crop;if(a&&a.isPerennial&&a.perennialEstablished){const i=R(a.cropId);if(i.yieldCurve&&a.perennialAge-(i.yearsToEstablish??0)>=i.yieldCurve.declineStartYear)return!0}}return!1}case"random":return n.next()<e.probability;default:{const o=e;throw new Error(`Unhandled condition type: ${o.type}`)}}}function tt(e,t){if(e.cooldownDays<=0)return!1;const n=t.eventLog.filter(o=>o.storyletId===e.id).sort((o,r)=>r.day-o.day)[0];return n?t.calendar.totalDay-n.day<e.cooldownDays:!1}function nt(e,t){return e.maxOccurrences===void 0?!1:t.eventLog.filter(o=>o.storyletId===e.id).length>=e.maxOccurrences}function Jt(e,t,n){const o=e.preconditions.filter(a=>a.type!=="random"),r=e.preconditions.filter(a=>a.type==="random");for(const a of o)if(!Qt(a,t,n))return!1;for(const a of r)if(!Qt(a,t,n))return!1;return!0}function Uo(e,t,n){if(e.activeEvent)return{fireEvent:null,newForeshadows:[]};const o=[];let r=null;for(const c of e.pendingForeshadows)if(!c.dismissed&&!(e.calendar.totalDay<c.eventFiresOnDay)){if(c.isFalseAlarm){c.dismissed=!0;continue}if(!r){const f=t.find(u=>u.id===c.storyletId);f&&!tt(f,e)&&!nt(f,e)&&(r=f),c.dismissed=!0}}if(r){for(const c of t)if(!(c.id===r.id||!c.foreshadowing||tt(c,e)||nt(c,e)||e.pendingForeshadows.some(u=>u.storyletId===c.id&&(!u.dismissed||u.eventFiresOnDay===e.calendar.totalDay)))&&Jt(c,e,n)){const u=n.next()<c.foreshadowing.reliability;o.push({storyletId:c.id,signal:c.foreshadowing.signal,appearsOnDay:e.calendar.totalDay,eventFiresOnDay:e.calendar.totalDay+c.foreshadowing.daysBeforeEvent,isFalseAlarm:!u,advisorSource:c.foreshadowing.advisorSource,dismissed:!1})}return{fireEvent:r,newForeshadows:o}}const a=[];for(const c of t)if(!(tt(c,e)||nt(c,e)||e.pendingForeshadows.some(u=>u.storyletId===c.id&&(!u.dismissed||u.eventFiresOnDay===e.calendar.totalDay)))&&Jt(c,e,n))if(c.foreshadowing){const u=n.next()<c.foreshadowing.reliability;o.push({storyletId:c.id,signal:c.foreshadowing.signal,appearsOnDay:e.calendar.totalDay,eventFiresOnDay:e.calendar.totalDay+c.foreshadowing.daysBeforeEvent,isFalseAlarm:!u,advisorSource:c.foreshadowing.advisorSource,dismissed:!1})}else a.push(c);if(a.length===0)return{fireEvent:null,newForeshadows:o};const i=a.find(c=>c.priority>=100);if(i)return{fireEvent:i,newForeshadows:o};const s=a.reduce((c,f)=>c+f.priority,0);if(s<=0)return{fireEvent:null,newForeshadows:o};let d=n.next()*s;for(const c of a)if(d-=c.priority,d<=0)return{fireEvent:c,newForeshadows:o};return{fireEvent:a[a.length-1],newForeshadows:o}}const Hn=[{id:"heatwave-advisory",type:"climate",title:"Heatwave Advisory",description:"The National Weather Service has issued a heatwave advisory for the San Joaquin Valley. Temperatures are expected to exceed 110°F for the next several days. Your crops are at risk.",preconditions:[{type:"min_year",year:2},{type:"season",season:"summer"},{type:"has_crop"},{type:"random",probability:.3}],priority:50,cooldownDays:180,foreshadowing:{signal:"Weather models show an extreme heat dome building over the Central Valley.",daysBeforeEvent:7,reliability:.75},choices:[{id:"emergency-irrigation",label:"Emergency Irrigation",description:"Run irrigation continuously to cool crops and soil. Costs $500 but protects yield.",cost:500,requiresCash:500,effects:[{type:"modify_cash",amount:-500},{type:"modify_moisture_all",amount:2},{type:"add_notification",message:"Emergency irrigation applied. Your crops survived the heat.",notificationType:"event_result"}]},{id:"wait-it-out",label:"Wait It Out",description:"Hope for the best. Crops may suffer yield loss.",effects:[{type:"modify_yield_modifier",cropId:"*",multiplier:.85,durationDays:14},{type:"add_notification",message:"The heatwave damaged some crops. Yield reduced by 15%.",notificationType:"event_result"}]}],tags:["climate","heat"]},{id:"water-allocation-cut",type:"regulatory",title:"Water Allocation Cut",description:"The State Water Resources Control Board has reduced irrigation allocations for your district due to drought conditions. You must decide how to manage with less water.",preconditions:[{type:"min_year",year:3},{type:"season",season:"summer"},{type:"random",probability:.2}],priority:60,cooldownDays:365,foreshadowing:{signal:"State officials are reviewing water allocation policies. Cuts may be coming.",daysBeforeEvent:14,reliability:.8},choices:[{id:"accept-higher-costs",label:"Buy Supplemental Water",description:"Purchase water from the spot market at higher prices. Irrigation costs increase by 50% for 90 days.",effects:[{type:"modify_irrigation_cost",multiplier:1.5,durationDays:90},{type:"add_notification",message:"You secured supplemental water rights. Irrigation costs increased for 90 days.",notificationType:"event_result"}]},{id:"cut-irrigation",label:"Accept Reduced Irrigation",description:"Follow the restriction. No watering for 45 days.",effects:[{type:"restrict_watering",durationDays:45},{type:"add_notification",message:"Water restriction in effect. No irrigation for 45 days.",notificationType:"event_result"}]}],tags:["regulatory","water"]},{id:"late-frost-warning",type:"climate",title:"Late Frost Warning",description:"An unexpected cold front is moving through the valley. Overnight temperatures may drop below freezing, threatening young crops.",preconditions:[{type:"season",season:"spring"},{type:"has_crop"},{type:"random",probability:.15}],priority:55,cooldownDays:365,foreshadowing:{signal:"Unusual cold air mass detected moving south through the valley.",daysBeforeEvent:3,reliability:.9},choices:[{id:"frost-protection",label:"Frost Protection",description:"Deploy frost blankets and wind machines. Costs $300 but saves your crops.",cost:300,requiresCash:300,effects:[{type:"modify_cash",amount:-300},{type:"add_notification",message:"Frost protection deployed. Your crops survived the cold snap.",notificationType:"event_result"}]},{id:"accept-risk",label:"Accept the Risk",description:"Frost damage is possible. Yield may be reduced.",effects:[{type:"modify_yield_modifier",cropId:"*",multiplier:.7,durationDays:7},{type:"add_notification",message:"Frost damaged some crops. Yield reduced by 30%.",notificationType:"event_result"}]}],tags:["climate","frost"]},{id:"tomato-market-surge",type:"market",title:"Tomato Market Surge",description:"Processing tomato prices have spiked due to supply shortages in other growing regions. If you have tomatoes in the field, this could be a windfall.",preconditions:[{type:"season_not",season:"winter"},{type:"min_year",year:2},{type:"random",probability:.1}],priority:45,cooldownDays:365,choices:[{id:"acknowledge-surge",label:"Good to Know",description:"Tomato prices will be 40% higher for the next 60 days.",effects:[{type:"modify_price_modifier",cropId:"processing-tomatoes",multiplier:1.4,durationDays:60},{type:"add_notification",message:"Tomato prices surged! Processing tomato revenue increased by 40% for 60 days.",notificationType:"event_result"}]}],tags:["market","tomatoes"]},{id:"groundwater-pumping-ban",type:"regulatory",title:"Groundwater Pumping Ban",description:"The state has imposed an emergency ban on groundwater pumping in your district due to critically low aquifer levels. You must decide how to handle the next 30 days without well water.",preconditions:[{type:"season",season:"summer"},{type:"min_year",year:5},{type:"random",probability:.12}],priority:55,cooldownDays:730,choices:[{id:"comply",label:"Comply with the Ban",description:"No irrigation for 30 days. Your crops will rely on whatever moisture is in the soil.",effects:[{type:"restrict_watering",durationDays:30},{type:"add_notification",message:"Groundwater pumping banned for 30 days. No irrigation available.",notificationType:"event_result"}]},{id:"buy-rights",label:"Buy Surface Water Rights",description:"Purchase surface water rights from the state. Costs $1,000 but keeps your irrigation running.",cost:1e3,requiresCash:1e3,effects:[{type:"modify_cash",amount:-1e3},{type:"add_notification",message:"You purchased surface water rights for $1,000. Irrigation continues normally.",notificationType:"event_result"}]}],tags:["regulatory","water","groundwater"]},{id:"advisor-orchard-decline",type:"advisor",title:"Aging Orchard Assessment",description:"I've been looking at your older trees, and some of them are past their prime. Yields are declining and will continue to drop. It might be time to think about replanting — either with younger trees of the same variety, or something new entirely.",preconditions:[{type:"has_declining_perennial"}],priority:90,cooldownDays:730,maxOccurrences:2,choices:[{id:"plan-replacement",label:"Plan Replacement",description:"Get advice on timing and costs for replanting aging orchards.",effects:[{type:"add_notification",message:'Dr. Santos: "Removing old trees costs $400-500 per plot. Plan your replanting during the dormant season to minimize lost production."',notificationType:"event_result"}]},{id:"keep-producing",label:"Keep Them Going",description:"Continue harvesting at reduced yields rather than investing in new trees.",effects:[{type:"add_notification",message:`Dr. Santos: "That's reasonable — even old trees produce some income. Just know that yields will keep dropping."`,notificationType:"event_result"}]}],tags:["advisor","perennials","decline"]},{id:"advisor-soil-nitrogen",type:"advisor",title:"Soil Health Check",description:"I've been looking at the soil test results for your fields, and the nitrogen levels are getting low. Depleted soils mean weaker crops and lower yields. You have some options to restore fertility.",preconditions:[{type:"min_year",year:2},{type:"avg_nitrogen_below",level:50}],priority:100,cooldownDays:365,maxOccurrences:3,choices:[{id:"buy-fertilizer",label:"Apply Nitrogen Fertilizer",description:"Purchase and apply commercial fertilizer to restore soil nitrogen. Quick results but costs money.",cost:400,requiresCash:400,effects:[{type:"modify_cash",amount:-400},{type:"modify_nitrogen_all",amount:60},{type:"add_notification",message:"Dr. Santos helped you apply nitrogen fertilizer. Soil fertility improved.",notificationType:"event_result"}]},{id:"acknowledge",label:"Thanks for the Heads Up",description:"Take note and plan to rotate crops next season to rebuild soil health naturally.",effects:[{type:"add_notification",message:"Dr. Santos recommends planting winter wheat or another light feeder to restore nitrogen naturally.",notificationType:"event_result"}]}],tags:["advisor","soil"]},{id:"advisor-crop-failure",type:"advisor",title:"Crop Loss Review",description:"I noticed you've had some recent crop losses. That's tough, but it's a learning opportunity. Let's look at what happened and how to reduce risk going forward.",preconditions:[{type:"consecutive_crop_failures",count:1}],priority:100,cooldownDays:180,maxOccurrences:5,choices:[{id:"diversify-advice",label:"Learn About Diversification",description:"Dr. Santos explains how planting different crops reduces risk from weather and market swings.",effects:[{type:"add_notification",message:`Dr. Santos: "Don't put all your eggs in one basket. Mix crop types and planting times to spread risk."`,notificationType:"event_result"}]},{id:"water-advice",label:"Get Irrigation Tips",description:"Review your watering strategy to prevent moisture stress from contributing to future losses.",effects:[{type:"add_notification",message:"Dr. Santos reviewed your irrigation records and suggested watering more frequently during heat events.",notificationType:"event_result"}]}],tags:["advisor","education"]},{id:"advisor-chill-warning",type:"advisor",title:"Winter Chill Hour Concerns",description:"I've been tracking the chill hour data for our region, and the numbers are trending down. Your almond and pistachio trees need cold winter nights to produce well. If winters keep warming, you may see yield losses — especially for almonds, which need more chill hours than pistachios.",preconditions:[{type:"any_perennial_planted"},{type:"min_year",year:8}],priority:100,cooldownDays:730,maxOccurrences:2,choices:[{id:"review-chill-data",label:"Show Me the Data",description:"Review the chill hour trends and what they mean for your orchard.",effects:[{type:"set_flag",flag:"chillHoursRevealed",value:!0},{type:"add_notification",message:"Dr. Santos shared chill hour data for your region. You can now see chill hour tracking for your perennial crops.",notificationType:"event_result"}]},{id:"plan-adaptation",label:"Help Me Plan Ahead",description:"Get advice on which tree crops are more resilient to declining chill hours.",effects:[{type:"set_flag",flag:"chillHoursRevealed",value:!0},{type:"add_notification",message:'Dr. Santos: "Pistachios need fewer chill hours than almonds. As winters warm, consider shifting toward more climate-resilient varieties."',notificationType:"event_result"}]}],tags:["advisor","chill","climate"]},{id:"advisor-drought-recovery",type:"advisor",title:"Financial Recovery Planning",description:"Times are tough, but I've seen farms recover from worse. Let's look at some strategies to rebuild your finances. The key is cutting costs where you can while keeping your most profitable acres producing.",preconditions:[{type:"cash_below",amount:3e4},{type:"min_year",year:4}],priority:90,cooldownDays:365,maxOccurrences:3,choices:[{id:"cost-cutting",label:"Review Cost-Cutting Options",description:"Focus on your most profitable crops and reduce planted acreage to match your budget.",effects:[{type:"add_notification",message:`Dr. Santos: "Focus on fewer, higher-value crops. It's better to farm 4 rows well than 8 rows poorly."`,notificationType:"event_result"}]},{id:"low-cost-crops",label:"What Are the Cheapest Crops?",description:"Learn which crops have the lowest input costs to help rebuild cash reserves.",effects:[{type:"add_notification",message:`Dr. Santos: "Winter wheat has the lowest seed and labor costs. It won't make you rich, but it keeps the farm running."`,notificationType:"event_result"}]}],tags:["advisor","finance"]},{id:"advisor-perennial-opportunity",type:"advisor",title:"Long-Term Investment Opportunity",description:"Your farm is doing well financially, and you don't have any debt — that puts you in a great position. Have you considered planting tree crops? Almonds and pistachios require patience (3-4 years before they produce), but the long-term returns can be excellent.",preconditions:[{type:"cash_above",amount:4e4},{type:"no_debt"},{type:"no_perennial_planted"},{type:"min_year",year:3}],priority:90,cooldownDays:365,maxOccurrences:1,choices:[{id:"learn-perennials",label:"Tell Me More",description:"Learn about the costs, timeline, and potential returns of perennial tree crops.",effects:[{type:"add_notification",message:'Dr. Santos: "Almonds and pistachios cost $900-960 to plant and need 3-4 years to establish. But once producing, they generate strong annual income for 20+ years."',notificationType:"event_result"}]},{id:"not-now",label:"Not Right Now",description:"You're happy with your current crop plan.",effects:[{type:"add_notification",message:`Dr. Santos: "No rush. The option will be there when you're ready. Just remember — the best time to plant a tree was yesterday."`,notificationType:"event_result"}]}],tags:["advisor","perennials"]}],Yo=[0,1,32,60,91,121,152,182,213,244,274,305,335],jo={1:"winter",2:"winter",3:"spring",4:"spring",5:"spring",6:"summer",7:"summer",8:"summer",9:"fall",10:"fall",11:"fall",12:"winter"};function ce(e){const t=Math.floor(e/le)+1,n=e%le+1;let o=12;for(let a=12;a>=1;a--)if(n>=Yo[a]){o=a;break}const r=jo[o];return{day:n,month:o,season:r,year:t,totalDay:e}}function Go(e){return(e+1)%le===0}function Wn(e,t){const n=ce(e),o=ce(t);return n.season!==o.season}function je(e){return e.charAt(0).toUpperCase()+e.slice(1)}function ne(e){return["","January","February","March","April","May","June","July","August","September","October","November","December"][e]??""}function Je(e,t,n){return t<=n?e>=t&&e<=n:e>=t||e<=n}function Un(e,t,n){const o=ce(t),r=o.year-1;if(r<0||r>=e.years.length)throw new Error(`No climate data for year ${o.year} (totalDay ${t})`);const i=e.years[r].seasons[o.season],s=(n.next()-.5)*2*i.tempVariance,d=(n.next()-.5)*2*i.tempVariance,c=i.avgTempHigh+s,f=Math.min(i.avgTempLow+d,c-5),p=n.chance(i.precipProbability)?i.precipIntensity*(.5+n.next()):0,v=i.avgET0*(.85+n.next()*.3);return{tempHigh:c,tempLow:f,precipitation:p,et0:v,isHeatwave:!1,isFrost:!1}}const Xt=3,Zt=5,Vo=90;function en(e){return e<=0?0:e>=1?1:1-Math.pow(1-e,1/Vo)}function Yn(e,t,n,o,r){const a=ce(o),i=a.year-1,s=n.years[i].seasons[a.season];if(e.activeHeatwaveDays>0)e.activeHeatwaveDays--,t.isHeatwave=!0,t.tempHigh+=10;else{const d=en(s.heatwaveProbability);if(r.chance(d)){const c=r.nextInt(Xt,Zt);e.activeHeatwaveDays=c-1,t.isHeatwave=!0,t.tempHigh+=10}}if(e.activeFrostDays>0)e.activeFrostDays--,t.isFrost=!0,t.tempLow=Math.min(t.tempLow,32);else{const d=en(s.frostProbability);if(r.chance(d)){const c=r.nextInt(Xt,Zt);e.activeFrostDays=c-1,t.isFrost=!0,t.tempLow=Math.min(t.tempLow,32)}}}const tn={"legume-cover":{id:"legume-cover",name:"Clover/Vetch Mix",seedCostPerAcre:30,nitrogenFixation:50,organicMatterBonus:.1,moistureDrawdown:.5,winterETMultiplier:.2,shortDescription:"Nitrogen-fixing legume mix. Costs $30/plot, adds +50 lbs/ac N and +0.10% OM at spring incorporation. Draws down 0.5in moisture."}};function ve(e){const t=tn[e];if(!t)throw new Error(`Unknown cover crop ID: "${e}". Valid IDs: ${Object.keys(tn).join(", ")}`);return t}const qo=typeof localStorage<"u"&&localStorage.getItem("playtestLog")==="1",ht=[];let Ko=1;function X(e,t,n){if(!qo)return;const o={seq:Ko++,ts:new Date().toISOString(),day:t.calendar.totalDay,year:t.calendar.year,season:t.calendar.season,type:e,payload:n};ht.push(o),console.log("%c[PLAYTEST]","color: #2e7d32; font-weight: bold",o)}function Et(e){X("session_start",e,{playerId:e.playerId,scenarioId:e.scenarioId})}function zo(e,t,n,o,r){X("command",e,{cmd:t.type,ok:n,reason:o,cashBefore:r!==void 0?Math.floor(r):void 0,cashAfter:Math.floor(e.economy.cash)})}function Qo(e,t,n,o,r){X("event_fired",e,{eventId:t,eventType:n,title:o,choices:r})}function Jo(e,t,n,o){X("event_choice",e,{eventId:t,choiceId:n,cashBefore:Math.floor(o),cashAfter:Math.floor(e.economy.cash)})}function Xo(e,t){X("loan_offer",e,{amount:t,cash:Math.floor(e.economy.cash),debt:Math.floor(e.economy.debt)})}function Zo(e,t){X("loan_taken",e,{amount:t,cashAfter:Math.floor(e.economy.cash),debtAfter:Math.floor(e.economy.debt)})}function jn(e,t,n,o){X("harvest",e,{cropId:t,revenue:Math.floor(n),cells:o,cash:Math.floor(e.economy.cash)})}function er(e){const t={};let n=0,o=0;const r=D*C;for(let a=0;a<D;a++)for(let i=0;i<C;i++){const s=e.grid[a][i];s.crop&&(t[s.crop.cropId]=(t[s.crop.cropId]||0)+1),n+=s.soil.nitrogen,o+=s.soil.organicMatter}X("year_end",e,{revenue:Math.floor(e.economy.yearlyRevenue),expenses:Math.floor(e.economy.yearlyExpenses),net:Math.floor(e.economy.yearlyRevenue-e.economy.yearlyExpenses),cash:Math.floor(e.economy.cash),debt:Math.floor(e.economy.debt),interestPaid:Math.floor(e.economy.interestPaidThisYear),avgNitrogen:Math.round(n/r),avgOrganicMatter:Math.round(o/r*100)/100,cropsById:t})}function nn(e,t){X("game_over",e,{reason:t,cash:Math.floor(e.economy.cash),debt:Math.floor(e.economy.debt),year:e.calendar.year})}typeof window<"u"&&(window.__playtestLog=ht,window.__exportPlaytestLog=()=>JSON.stringify(ht,null,2));function tr(e,t){const n=[];for(let i=0;i<D;i++){const s=[];for(let d=0;d<C;d++)s.push({row:i,col:d,crop:null,soil:nr(),coverCropId:null});n.push(s)}const o=new Ye(t.seed),r={activeHeatwaveDays:0,activeFrostDays:0};for(let i=0;i<qt;i++){const s=Un(t,i,o);Yn(r,s,t,i,o)}const a=new Ye(t.seed+On);return{calendar:ce(qt),speed:0,grid:n,economy:{cash:Ro,yearlyRevenue:0,yearlyExpenses:0,debt:0,totalLoansReceived:0,interestPaidThisYear:0},notifications:[],autoPauseQueue:[],playerId:e,scenarioId:t.id,rngState:o.getState(),waterStressPausedThisSeason:!1,activeHeatwaveDays:r.activeHeatwaveDays,activeFrostDays:r.activeFrostDays,nextNotificationId:1,gameOver:!1,yearEndSummaryPending:!1,eventLog:[],activeEvent:null,pendingForeshadows:[],activeEffects:[],cropFailureStreak:0,flags:{},wateringRestricted:!1,wateringRestrictionEndsDay:0,irrigationCostMultiplier:1,eventRngState:a.getState(),frostProtectionEndsDay:0}}function nr(){const e=Mo;return{nitrogen:Ao,organicMatter:e,moisture:xo,moistureCapacity:Bn+(e-2)*Ln}}function De(e,t){if(!Number.isFinite(e))throw new Error(`Invalid state: ${t} is ${e} (expected finite number)`)}function Y(e,t,n){const o=e.economy.cash;let r;switch(t.type){case"SET_SPEED":r=or(e,t.speed);break;case"PLANT_CROP":r=rr(e,t.cellRow,t.cellCol,t.cropId);break;case"PLANT_BULK":r=ar(e,t.scope,t.cropId,t.index);break;case"HARVEST":r=ir(e,t.cellRow,t.cellCol);break;case"HARVEST_BULK":r=sr(e,t.scope,t.index);break;case"WATER":r=lr(e,t.scope,t.index);break;case"RESPOND_EVENT":r=cr(e,t.eventId,t.choiceId);break;case"TAKE_LOAN":r=ur(e);break;case"REMOVE_CROP":r=dr(e,t.cellRow,t.cellCol);break;case"SET_COVER_CROP":r=hr(e,t.cellRow,t.cellCol,t.coverCropId);break;case"SET_COVER_CROP_BULK":r=_r(e,t.scope,t.coverCropId,t.index);break;default:{const a=t;throw new Error(`Unhandled command type: ${a.type}`)}}return t.type!=="SET_SPEED"&&zo(e,t,r.success,r.reason,o),r}function or(e,t){return e.speed=t,{success:!0}}function rr(e,t,n,o){const r=Xe(e,t,n);if(!r)return{success:!1,reason:"Invalid cell position."};if(r.crop)return{success:!1,reason:"This plot already has a crop."};const a=R(o),i=e.calendar;if(!Je(i.month,a.plantingWindow.startMonth,a.plantingWindow.endMonth))return{success:!1,reason:`${a.name} can only be planted ${ne(a.plantingWindow.startMonth)}–${ne(a.plantingWindow.endMonth)}.`};const s=a.seedCostPerAcre;return e.economy.cash<s?{success:!1,reason:`Not enough cash. Cost: $${s}, Available: $${Math.floor(e.economy.cash)}.`}:(e.economy.cash-=s,e.economy.yearlyExpenses+=s,r.crop=zn(o,e.calendar.totalDay),a.type==="perennial"&&!e.flags.chillHoursRevealed&&(e.flags.chillHoursRevealed=!0),{success:!0,cost:s,cellsAffected:1})}function ar(e,t,n,o){const r=R(n),a=e.calendar;if(!Je(a.month,r.plantingWindow.startMonth,r.plantingWindow.endMonth))return{success:!1,reason:`${r.name} can only be planted ${ne(r.plantingWindow.startMonth)}–${ne(r.plantingWindow.endMonth)}.`};const i=Cr(e,t,o);if(i.length===0)return{success:!1,reason:"No empty plots in the selected area."};const s=r.seedCostPerAcre;if(t==="all"){if(Math.floor(e.economy.cash/s)<=0)return{success:!1,reason:`Not enough cash. Cost per plot: $${s}.`};const c=Qn(i),f=[];for(const[,w]of c)w.length===C&&f.push(w);const u=f.flat(),p=u.length*s;if(u.length===0)return{success:!1,reason:'No fully empty rows available. Use "Plant Row" to fill specific rows.'};if(e.economy.cash>=p)return _t(e,u,n,s);let v=0,b=0,S=0;for(const w of f){const g=w.length*s;if(S+g<=e.economy.cash)v++,b+=w.length,S+=g;else break}return v===0?{success:!1,reason:`Not enough cash to plant a full row. Cost per row: $${C*s}, Available: $${Math.floor(e.economy.cash)}.`}:{success:!1,reason:"partial",partialOffer:{affordableRows:v,affordablePlots:b,totalCost:S}}}else{const d=i.length*s;return e.economy.cash<d?{success:!1,reason:`Not enough cash to plant this ${t}. Cost: $${d}, Available: $${Math.floor(e.economy.cash)}.`}:_t(e,i,n,s)}}function _t(e,t,n,o){const r=t.length*o;e.economy.cash-=r,e.economy.yearlyExpenses+=r;for(const a of t)a.crop=zn(n,e.calendar.totalDay);return e.flags.chillHoursRevealed||R(n).type==="perennial"&&(e.flags.chillHoursRevealed=!0),{success:!0,cost:r,cellsAffected:t.length}}function ir(e,t,n){const o=Xe(e,t,n);if(!o)return{success:!1,reason:"Invalid cell position."};if(!o.crop)return{success:!1,reason:"No crop to harvest."};const r=o.crop.growthStage;if(r!=="harvestable"&&r!=="overripe")return{success:!1,reason:`Crop is not ready to harvest (${r}).`};if(o.crop.isPerennial&&o.crop.harvestedThisSeason)return{success:!1,reason:"Already harvested this season. Trees produce one crop per year."};const a=o.crop.cropId,i=Kn(e,o);return jn(e,a,i,1),{success:!0,revenue:i,cellsAffected:1}}function sr(e,t,n){const o=Sr(e,t,n);if(o.length===0)return{success:!1,reason:"No crops ready to harvest."};let r=0;for(const a of o)r+=Kn(e,a);return jn(e,`bulk_${t}`,r,o.length),{success:!0,revenue:r,cellsAffected:o.length}}function lr(e,t,n){if(e.wateringRestricted)return{success:!1,reason:"Watering is currently restricted by water allocation regulations."};const o=Tt(e,t,n).filter(s=>s.crop!==null);if(o.length===0)return{success:!1,reason:"No planted plots to water."};const r=At(e),a=Qe*r,i=o.length*a;if(t==="all"){if(e.economy.cash<i){if(Math.floor(e.economy.cash/a)<=0)return{success:!1,reason:`Not enough cash to water. Cost per plot: $${a}.`};const d=Qn(o);let c=0,f=0,u=0;for(const[,p]of d){const v=p.length*a;if(u+v<=e.economy.cash)c++,f+=p.length,u+=v;else break}return c===0?{success:!1,reason:"Not enough cash to water a full row."}:{success:!1,reason:"partial",partialOffer:{affordableRows:c,affordablePlots:f,totalCost:u}}}}else if(e.economy.cash<i)return{success:!1,reason:`Not enough cash to water this ${t}. Cost: $${i}, Available: $${Math.floor(e.economy.cash)}.`};return Gn(e,o)}function Gn(e,t){const n=At(e),o=Qe*n,r=t.length*o;e.economy.cash-=r,e.economy.yearlyExpenses+=r;for(const a of t)a.soil.moisture=Math.min(a.soil.moisture+Fo,a.soil.moistureCapacity);return{success:!0,cost:r,cellsAffected:t.length}}function cr(e,t,n){if(!e.activeEvent)return{success:!1,reason:"No active event to respond to."};if(e.activeEvent.storyletId!==t)return{success:!1,reason:"Event ID mismatch."};const o=e.activeEvent.choices.find(a=>a.id===n);if(!o)return{success:!1,reason:`Invalid choice: ${n}.`};if(o.requiresCash!==void 0&&e.economy.cash<o.requiresCash)return{success:!1,reason:`Not enough cash. Requires $${o.requiresCash}.`};const r=e.economy.cash;return Er(e,o.effects,t),e.eventLog.push({storyletId:t,day:e.calendar.totalDay,choiceId:n}),Jo(e,t,n,r),e.activeEvent=null,{success:!0}}function Vn(e){return Math.ceil((Math.abs(e)+5e3)/1e3)*1e3}function ur(e){if(!e.autoPauseQueue.some(o=>o.reason==="loan_offer"))return{success:!1,reason:"No loan offer is currently available."};if(e.economy.totalLoansReceived>=1)return{success:!1,reason:"You have already received an emergency loan."};const n=Vn(e.economy.cash);return e.economy.cash+=n,e.economy.debt=n,e.economy.totalLoansReceived=1,U(e,"loan",`Emergency loan of $${n.toLocaleString()} received. 10% annual interest. 20% of harvest revenue will go toward repayment.`),Zo(e,n),e.gameOver=!1,e.gameOverReason=void 0,{success:!0}}function dr(e,t,n){const o=Xe(e,t,n);if(!o)return{success:!1,reason:"Invalid cell position."};if(!o.crop)return{success:!1,reason:"This plot has no crop to remove."};if(!o.crop.isPerennial)return{success:!1,reason:"Use harvest to clear annual crops."};const r=R(o.crop.cropId),a=r.removalCost??0;return e.economy.cash<a?{success:!1,reason:`Not enough cash. Removal cost: $${a}, Available: $${Math.floor(e.economy.cash)}.`}:(e.economy.cash-=a,e.economy.yearlyExpenses+=a,U(e,"info",`Removed ${r.name} from row ${t+1}, col ${n+1}. Cost: $${a}.`),o.crop=null,{success:!0,cost:a})}function fr(e){return e.crop?e.crop.isPerennial?(R(e.crop.cropId).dormantSeasons?.length??0)>0:!1:!0}function pr(e,t,n,o){const r=t.length*o;e.economy.cash-=r,e.economy.yearlyExpenses+=r;for(const a of t)a.coverCropId=n;return{success:!0,cost:r,cellsAffected:t.length}}function hr(e,t,n,o){const r=Xe(e,t,n);if(!r)return{success:!1,reason:"Invalid cell position."};if(o===null)return r.coverCropId=null,{success:!0};if(e.calendar.season!=="fall")return{success:!1,reason:"Cover crops can only be planted in fall (September–November)."};if(r.coverCropId)return{success:!1,reason:"This plot already has a cover crop."};if(r.crop){if(!r.crop.isPerennial)return{success:!1,reason:"Cannot plant cover crop on a cell with an annual crop."};const i=R(r.crop.cropId);if(!i.dormantSeasons||i.dormantSeasons.length===0)return{success:!1,reason:"Cannot plant cover crop under an evergreen perennial."}}const a=ve(o);return e.economy.cash<a.seedCostPerAcre?{success:!1,reason:`Not enough cash. Cost: $${a.seedCostPerAcre}, Available: $${Math.floor(e.economy.cash)}.`}:(e.economy.cash-=a.seedCostPerAcre,e.economy.yearlyExpenses+=a.seedCostPerAcre,r.coverCropId=o,{success:!0,cost:a.seedCostPerAcre})}function _r(e,t,n,o){if(n===null){let d=0;return on(e,t,o,c=>{c.coverCropId&&(c.coverCropId=null,d++)}),{success:!0,cellsAffected:d}}if(e.calendar.season!=="fall")return{success:!1,reason:"Cover crops can only be planted in fall (September–November)."};const r=ve(n),a=[];if(on(e,t,o,d=>{!d.coverCropId&&fr(d)&&a.push(d)}),a.length===0)return{success:!1,reason:"No eligible plots for cover crops."};const i=a.length*r.seedCostPerAcre;if(e.economy.cash<i&&t==="all"){const d=Math.floor(e.economy.cash/r.seedCostPerAcre),c=Math.floor(d/C);return c===0?{success:!1,reason:`Not enough cash. Need $${i}, have $${Math.floor(e.economy.cash)}.`}:{success:!1,reason:"Not enough cash for all plots.",partialOffer:{affordableRows:c,affordablePlots:c*C,totalCost:c*C*r.seedCostPerAcre}}}if(e.economy.cash<i)return{success:!1,reason:`Not enough cash. Need $${i}, have $${Math.floor(e.economy.cash)}.`};let s=0;for(const d of a)d.coverCropId=n,e.economy.cash-=r.seedCostPerAcre,e.economy.yearlyExpenses+=r.seedCostPerAcre,s++;return{success:!0,cellsAffected:s,cost:s*r.seedCostPerAcre}}function on(e,t,n,o){if(t==="all")for(let r=0;r<D;r++)for(let a=0;a<C;a++)o(e.grid[r][a]);else if(t==="row"&&n!==void 0)for(let r=0;r<C;r++)o(e.grid[n][r]);else if(t==="col"&&n!==void 0)for(let r=0;r<D;r++)o(e.grid[r][n])}function vr(e){let t=0;for(let n=0;n<D;n++)for(let o=0;o<C;o++){const r=e.grid[n][o];if(!r.coverCropId)continue;const a=ve(r.coverCropId);r.soil.nitrogen=Math.min(200,r.soil.nitrogen+a.nitrogenFixation),r.soil.organicMatter+=a.organicMatterBonus,r.soil.moisture=Math.max(0,r.soil.moisture-a.moistureDrawdown),r.coverCropId=null,t++}t>0&&U(e,"info",`Cover crops incorporated on ${t} plot${t!==1?"s":""}: +50 lbs/ac nitrogen, +0.10% organic matter, -0.5in moisture`)}function mr(e,t){if(e.gameOver||e.speed===0||e.autoPauseQueue.length>0)return null;const n=e.calendar.totalDay,o=n+1;if(o>=To*le)return e.autoPauseQueue.push({reason:"year_30",message:`Congratulations! You completed 30 years of farming! Final cash: $${Math.floor(e.economy.cash).toLocaleString()}.`}),e.gameOver=!0,e.speed=0,nn(e,"year_30_complete"),null;const r=new Ye(e.rngState),a=Un(t,o,r);if(Yn(e,a,t,o,r),e.rngState=r.getState(),e.calendar=ce(o),Wn(n,o)){e.waterStressPausedThisSeason=!1;const f=je(e.calendar.season);U(e,"season_change",`${f} — Year ${e.calendar.year}`),e.calendar.season==="spring"&&vr(e)}Tr(e);let i=!1,s=!1;for(let f=0;f<D;f++)for(let u=0;u<C;u++){const p=e.grid[f][u];yr(p,a),p.crop&&(gr(p,a,e,t),p.crop&&p.crop.growthStage==="harvestable"&&!(p.crop.isPerennial&&p.crop.harvestedThisSeason)&&(i=!0),p.crop&&p.soil.moisture<p.soil.moistureCapacity*Io&&(s=!0))}i&&e.autoPauseQueue.push({reason:"harvest_ready",message:"Your crops are ready to harvest!"}),s&&!e.waterStressPausedThisSeason&&(e.waterStressPausedThisSeason=!0,e.autoPauseQueue.push({reason:"water_stress",message:"Some of your crops need water!"}));const d=new Ye(e.eventRngState),c=Uo(e,Hn,d);e.eventRngState=d.getState();for(const f of c.newForeshadows)e.pendingForeshadows.push(f),U(e,"foreshadowing",f.signal);if(c.fireEvent){const f=c.fireEvent;e.activeEvent={storyletId:f.id,title:f.title,description:f.description,choices:f.choices,firedOnDay:o},e.autoPauseQueue.push({reason:f.type==="advisor"?"advisor":"event",message:f.title}),Qo(e,f.id,f.type,f.title,f.choices.map(u=>u.id))}if(e.economy.debt>0){const f=e.economy.debt*(Kt/le);e.economy.debt+=f,e.economy.interestPaidThisYear+=f,e.economy.debt>zt&&(e.gameOver=!0,e.gameOverReason="debt_spiral",e.speed=0,e.autoPauseQueue.push({reason:"bankruptcy",message:`Your debt has exceeded $${zt.toLocaleString()}. The bank has foreclosed on your farm.`,data:{debt:e.economy.debt}}))}if(Go(o)){for(let f=0;f<D;f++)for(let u=0;u<C;u++){const p=e.grid[f][u];if(p.crop&&p.crop.isPerennial){p.crop.perennialAge++;const v=R(p.crop.cropId);!p.crop.perennialEstablished&&v.yearsToEstablish&&p.crop.perennialAge>=v.yearsToEstablish&&(p.crop.perennialEstablished=!0),p.crop.harvestedThisSeason=!1,v.annualMaintenanceCost&&(e.economy.cash-=v.annualMaintenanceCost,e.economy.yearlyExpenses+=v.annualMaintenanceCost)}}e.yearEndSummaryPending=!0,e.autoPauseQueue.push({reason:"year_end",message:`Year ${e.calendar.year} is complete.`,data:{year:e.calendar.year,revenue:e.economy.yearlyRevenue,expenses:e.economy.yearlyExpenses,netProfit:e.economy.yearlyRevenue-e.economy.yearlyExpenses,cash:e.economy.cash,debt:e.economy.debt,interestPaid:e.economy.interestPaidThisYear}}),er(e)}if(e.economy.cash<=0&&!e.gameOver)if(e.economy.totalLoansReceived===0){const f=Vn(e.economy.cash);e.autoPauseQueue.push({reason:"loan_offer",message:`You've run out of money. The bank is offering an emergency loan of $${f.toLocaleString()}.`,data:{loanAmount:f,interestRate:Kt,cash:e.economy.cash}}),Xo(e,f),e.gameOver=!0,e.gameOverReason="bankruptcy",e.speed=0}else e.gameOver=!0,e.gameOverReason="bankruptcy",e.speed=0,e.autoPauseQueue.push({reason:"bankruptcy",message:"You've run out of money again. With an outstanding loan, the bank can no longer help.",data:{cash:e.economy.cash,debt:e.economy.debt,yearlyRevenue:e.economy.yearlyRevenue,yearlyExpenses:e.economy.yearlyExpenses}}),nn(e,"bankruptcy");return e.autoPauseQueue.length>1&&e.autoPauseQueue.sort((f,u)=>Vt[u.reason]-Vt[f.reason]),e.autoPauseQueue.length>0&&(e.speed=0),De(e.economy.cash,"economy.cash"),a}function yr(e,t){const n=e.soil;let o;if(e.crop){const i=br(e.crop);if(e.coverCropId){const s=ve(e.coverCropId);o=Math.max(i,s.winterETMultiplier)}else o=i}else e.coverCropId?o=ve(e.coverCropId).winterETMultiplier:o=.3;const r=t.et0*o;if(n.moisture=Math.max(0,n.moisture-r),n.moisture=Math.min(n.moisture+t.precipitation,n.moistureCapacity),!e.coverCropId){const i=.02/le;n.organicMatter=Math.max(.5,n.organicMatter-n.organicMatter*i)}n.moistureCapacity=Bn+(n.organicMatter-2)*Ln;const a=n.organicMatter/100*30/le;n.nitrogen=Math.min(n.nitrogen+a,200),De(n.moisture,"soil.moisture"),De(n.nitrogen,"soil.nitrogen"),De(n.organicMatter,"soil.organicMatter")}function gr(e,t,n,o){const r=e.crop,a=R(r.cropId);if(r.isPerennial&&a.dormantSeasons){const u=a.dormantSeasons.includes(n.calendar.season);if(u&&!r.isDormant?(r.isDormant=!0,r.chillHoursAccumulated=0):!u&&r.isDormant&&(r.isDormant=!1,r.gddAccumulated=0,r.waterStressDays=0,r.plantedDay=n.calendar.totalDay,r.harvestedThisSeason=!1,r.growthStage="seedling",r.overripeDaysRemaining=-1),r.isDormant){if(a.chillHoursRequired!==void 0){const p=Math.max(0,Math.min(n.calendar.year-1,o.years.length-1)),b=o.years[p].chillHours/Ho;r.chillHoursAccumulated+=b}return}}if(r.growthStage==="overripe"){if(r.overripeDaysRemaining--,r.overripeDaysRemaining<=0){if(r.isPerennial){r.growthStage="mature",r.overripeDaysRemaining=-1,r.gddAccumulated=a.gddToMaturity*.8,U(n,"info",`Your ${a.name} in row ${e.row+1} missed the harvest window. No yield this season, but the trees survive.`);return}U(n,"crop_rotted",`Your ${a.name} in row ${e.row+1} rotted in the field. Total loss.`),e.crop=null;return}return}if(r.growthStage==="harvestable"){r.growthStage="overripe",r.overripeDaysRemaining=kt;return}const i=(t.tempHigh+t.tempLow)/2,s=Math.max(0,i-a.gddBase);r.gddAccumulated+=s,e.soil.moisture<e.soil.moistureCapacity*.15&&r.waterStressDays++;const d=s/a.gddToMaturity,c=a.nitrogenUptake*d;e.soil.nitrogen=Math.max(0,e.soil.nitrogen-c);const f=r.gddAccumulated/a.gddToMaturity;r.isPerennial&&!r.perennialEstablished?r.growthStage=rn(Math.min(f,.49)):r.growthStage=rn(f)}function rn(e){return e>=1?"harvestable":e>=.8?"mature":e>=.5?"flowering":e>=.2?"vegetative":"seedling"}function br(e){if(e.isPerennial&&e.isDormant)return .2;const n=R(e.cropId).cropCoefficients.find(o=>o.stage===e.growthStage);return n?n.kc:.5}function qn(e,t){if(!e.isPerennial||!e.perennialEstablished||!t.yieldCurve)return 1;const n=e.perennialAge-(t.yearsToEstablish??0),o=t.yieldCurve;if(n<0)return 0;if(n<o.rampUpYears)return o.rampUpYears<=1?1:.6+.4*(n/(o.rampUpYears-1));if(n<o.declineStartYear)return 1;if(n>=o.endOfLifeYear)return o.declineFloor;const r=o.endOfLifeYear-o.declineStartYear;if(r===0)return o.declineFloor;const a=n-o.declineStartYear;return 1-(1-o.declineFloor)*(a/r)}function ot(e,t){if(!e.perennialEstablished)return"Establishing";if(!t.yieldCurve)return"Peak Production";const n=e.perennialAge-(t.yearsToEstablish??0),o=t.yieldCurve;return n<0?"Establishing":n<o.rampUpYears?"Ramping Up":n<o.declineStartYear?"Peak Production":n>=o.endOfLifeYear?"Past Prime":"Declining"}function Kn(e,t){const n=t.crop,o=R(n.cropId);let r=o.yieldPotential;n.isPerennial&&!n.perennialEstablished&&(r=0);const a=Math.max(1,e.calendar.totalDay-n.plantedDay),i=n.waterStressDays/a,s=Math.max(0,1-o.ky*i);r*=s;const d=Math.min(1,(t.soil.nitrogen+o.nitrogenUptake*.5)/o.nitrogenUptake);if(r*=d,n.growthStage==="overripe"){const g=n.overripeDaysRemaining/kt;r*=g}const c=Rr(e,n.cropId);if(r*=c,o.chillHoursRequired!==void 0&&n.isPerennial&&n.perennialEstablished){const g=o.chillHoursRequired===0?1:Math.min(1,Math.max(0,n.chillHoursAccumulated/o.chillHoursRequired));if(r*=g,g<1){const m=o.chillHoursRequired-n.chillHoursAccumulated,I=Math.round((1-g)*100);U(e,"info",`${o.name}: insufficient chill hours (${Math.round(n.chillHoursAccumulated)}/${o.chillHoursRequired}). Yield reduced by ${I}% (deficit: ${Math.round(m)} hours).`)}}const f=qn(n,o);r*=f,r=Math.max(0,r);const u=Ar(e,n.cropId),p=o.basePrice*u,v=r*p,b=o.laborCostPerAcre;e.economy.cash+=v,e.economy.yearlyRevenue+=v,e.economy.yearlyExpenses+=b,e.economy.cash-=b;let S=0;e.economy.debt>0&&(S=Math.min(v*Wo,e.economy.debt),e.economy.cash-=S,e.economy.debt-=S,e.economy.yearlyExpenses+=S);const w=v-b-S;return S>0?U(e,"harvest",`Harvested ${o.name}: ${r.toFixed(1)} ${o.yieldUnit} at $${p.toFixed(2)}/${o.yieldUnit} = $${v.toFixed(0)} (labor: $${b}, loan repayment: $${S.toFixed(0)})`):U(e,"harvest",`Harvested ${o.name}: ${r.toFixed(1)} ${o.yieldUnit} at $${p.toFixed(2)}/${o.yieldUnit} = $${v.toFixed(0)} (labor: $${b})`),n.isPerennial?(n.growthStage="mature",n.gddAccumulated=o.gddToMaturity*.8,n.overripeDaysRemaining=-1,n.waterStressDays=0,n.plantedDay=e.calendar.totalDay,n.harvestedThisSeason=!0):t.crop=null,De(e.economy.cash,"economy.cash after harvest"),w}function wr(e){e.economy.yearlyRevenue=0,e.economy.yearlyExpenses=0,e.economy.interestPaidThisYear=0,e.yearEndSummaryPending=!1}function zn(e,t){const n=R(e);return{cropId:e,plantedDay:t,gddAccumulated:0,waterStressDays:0,growthStage:"seedling",overripeDaysRemaining:-1,isPerennial:n.type==="perennial",perennialAge:0,perennialEstablished:!1,isDormant:!1,harvestedThisSeason:!1,chillHoursAccumulated:0}}function Xe(e,t,n){return t<0||t>=D||n<0||n>=C?null:e.grid[t][n]}function Tt(e,t,n){const o=[];for(let r=0;r<D;r++)for(let a=0;a<C;a++)(t==="all"||t==="row"&&r===n||t==="col"&&a===n)&&o.push(e.grid[r][a]);return o}function Cr(e,t,n){return Tt(e,t,n).filter(o=>o.crop===null)}function Sr(e,t,n){return Tt(e,t,n).filter(o=>o.crop!==null&&(o.crop.growthStage==="harvestable"||o.crop.growthStage==="overripe")&&!(o.crop.isPerennial&&o.crop.harvestedThisSeason))}function Qn(e){const t=new Map,n=[...e].sort((o,r)=>o.row-r.row||o.col-r.col);for(const o of n){const r=t.get(o.row);r?r.push(o):t.set(o.row,[o])}return t}function U(e,t,n){e.notifications.push({id:e.nextNotificationId++,type:t,message:n,day:e.calendar.totalDay})}function $r(e,t){e.notifications=e.notifications.filter(n=>n.id!==t)}function Dr(e){const t=e.autoPauseQueue.shift();t&&(t.reason==="event"||t.reason==="advisor")&&e.activeEvent&&(e.eventLog.push({storyletId:e.activeEvent.storyletId,day:e.calendar.totalDay,choiceId:"__dismissed__"}),e.activeEvent=null)}function Pr(e){const{month:t}=e.calendar;return Fn().filter(n=>{const o=R(n);return Je(t,o.plantingWindow.startMonth,o.plantingWindow.endMonth)})}function kr(e){return e.growthStage==="overripe"?Math.max(0,e.overripeDaysRemaining/kt*100):e.growthStage==="harvestable"?100:0}function Jn(e){const t=R(e.cropId);return Math.min(1,e.gddAccumulated/t.gddToMaturity)}function Rt(e){return Math.max(0,Math.min(10,e))}function Er(e,t,n){for(const o of t)switch(o.type){case"modify_cash":e.economy.cash+=o.amount,e.economy.yearlyExpenses+=Math.max(0,-o.amount),e.economy.yearlyRevenue+=Math.max(0,o.amount);break;case"modify_moisture_all":for(let r=0;r<D;r++)for(let a=0;a<C;a++){const i=e.grid[r][a].soil;i.moisture=Math.max(0,Math.min(i.moisture+o.amount,i.moistureCapacity))}break;case"modify_nitrogen_all":for(let r=0;r<D;r++)for(let a=0;a<C;a++){const i=e.grid[r][a].soil;i.nitrogen=Math.max(0,Math.min(i.nitrogen+o.amount,200))}break;case"modify_yield_modifier":e.activeEffects.push({effectType:"yield_modifier",cropId:o.cropId,multiplier:o.multiplier,expiresDay:e.calendar.totalDay+o.durationDays,sourceEventId:n});break;case"modify_price_modifier":e.activeEffects.push({effectType:"price_modifier",cropId:o.cropId,multiplier:o.multiplier,expiresDay:e.calendar.totalDay+o.durationDays,sourceEventId:n});break;case"modify_irrigation_cost":e.activeEffects.push({effectType:"irrigation_cost_modifier",multiplier:o.multiplier,expiresDay:e.calendar.totalDay+o.durationDays,sourceEventId:n});break;case"add_notification":U(e,o.notificationType,o.message);break;case"restrict_watering":e.wateringRestricted=!0,e.wateringRestrictionEndsDay=e.calendar.totalDay+o.durationDays,e.activeEffects.push({effectType:"watering_restriction",expiresDay:e.calendar.totalDay+o.durationDays,sourceEventId:n});break;case"set_flag":e.flags[o.flag]=o.value;break;default:{const r=o;throw new Error(`Unhandled effect type: ${r.type}`)}}}function Tr(e){const t=e.calendar.totalDay,n=e.activeEffects.filter(o=>t>=o.expiresDay);e.activeEffects=e.activeEffects.filter(o=>t<o.expiresDay);for(const o of n)o.effectType==="watering_restriction"&&(e.wateringRestricted=!1)}function Rr(e,t){let n=1;for(const o of e.activeEffects)o.effectType==="yield_modifier"&&o.multiplier!==void 0&&(o.cropId==="*"||o.cropId===t)&&(n*=o.multiplier);return Rt(n)}function Ar(e,t){let n=1;for(const o of e.activeEffects)o.effectType==="price_modifier"&&o.multiplier!==void 0&&(o.cropId==="*"||o.cropId===t)&&(n*=o.multiplier);return Rt(n)}function At(e){let t=1;for(const n of e.activeEffects)n.effectType==="irrigation_cost_modifier"&&n.multiplier!==void 0&&(t*=n.multiplier);return Rt(t)}function Me(e={}){return{avgTempHigh:75,avgTempLow:50,tempVariance:8,precipProbability:.05,precipIntensity:.3,avgET0:.2,heatwaveProbability:0,frostProbability:0,...e}}function Mr(e){const t=(e-1)*.1,n=Math.max(.7,1-(e-1)*.008),o=e===3,r=e>=10?.02:0,a=e<=5?800:e<=15?700:e<=25?630:570;return{year:e,chillHours:a,seasons:{spring:Me({avgTempHigh:75+t,avgTempLow:48+t,tempVariance:10,precipProbability:.12,precipIntensity:.4,avgET0:.18,frostProbability:e<=5?.05:.02}),summer:Me({avgTempHigh:(o?102:97)+t,avgTempLow:63+t,tempVariance:6,precipProbability:o?.01:.03,precipIntensity:.2,avgET0:o?.35:.3,heatwaveProbability:o?.4:.1+r}),fall:Me({avgTempHigh:78+t,avgTempLow:50+t,tempVariance:12,precipProbability:.08,precipIntensity:.5,avgET0:.15}),winter:Me({avgTempHigh:57+t,avgTempLow:38+t,tempVariance:8,precipProbability:.2,precipIntensity:.6,avgET0:.08,frostProbability:e<=15?.15:.08})},waterAllocation:n}}const Xn=[];for(let e=1;e<=30;e++)Xn.push(Mr(e));const Mt={id:"slice-1-baseline",name:"Gradual Challenge",description:"A manageable 30-year track with gradual warming and one dry summer early on. Good for learning the basics.",seed:42,years:Xn},xt="climateFarmer_autosave",me="climateFarmer_save_",Zn="climateFarmer_tutorialDismissed";function eo(e){return to(xt,e)}function xr(e,t){return to(me+t,e)}function to(e,t){const n={version:Nn,state:t,timestamp:Date.now()};try{return localStorage.setItem(e,JSON.stringify(n)),{success:!0}}catch(o){return{success:!1,error:o instanceof Error?o.message:String(o)}}}function Ir(){return no(xt)}function Br(e){return no(me+e)}function no(e){try{const t=localStorage.getItem(e);if(!t)return null;const n=JSON.parse(t);if(!ro(n)){if(lo(n))return pe(n);if(ao(n)){const o=Ge(n);if(o){const r={version:"3.0.0",state:o,timestamp:n.timestamp??Date.now()};return pe(r)}}if(io(n)){const o=so(n);if(o){const r={version:"2.0.0",state:o,timestamp:Date.now()},a=Ge(r);if(a){const i={version:"3.0.0",state:a,timestamp:Date.now()};return pe(i)}}}return null}return n.state}catch{return null}}function Lr(){return localStorage.getItem(xt)!==null}function Nr(){for(let e=0;e<localStorage.length;e++){const t=localStorage.key(e);if(t&&t.startsWith(me))return!0}return!1}function Or(){const e=[];for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);if(!(!n||!n.startsWith(me)))try{const o=localStorage.getItem(n);if(!o)continue;const r=JSON.parse(o),a=r.timestamp??Date.now();let i=null;if(ro(r))i=r.state;else if(lo(r))i=pe(r);else if(ao(r)){const s=Ge(r);s&&(i=pe({version:"3.0.0",state:s,timestamp:a}))}else if(io(r)){const s=so(r);if(s){const c=Ge({version:"2.0.0",state:s,timestamp:a});c&&(i=pe({version:"3.0.0",state:c,timestamp:a}))}}if(!i)continue;e.push({slotName:n.slice(me.length),timestamp:a,playerId:i.playerId,day:i.calendar.totalDay,year:i.calendar.year})}catch{}}return e.sort((t,n)=>n.timestamp-t.timestamp)}function Fr(e){localStorage.removeItem(me+e)}function oo(){return localStorage.getItem(Zn)==="true"}function Hr(e){localStorage.setItem(Zn,"true")}function ro(e){if(!e||typeof e!="object")return!1;const t=e;if(t.version!==Nn||typeof t.timestamp!="number"||!t.state||typeof t.state!="object")return!1;const n=t.state;if(!n.calendar||typeof n.calendar!="object"||!n.grid||!Array.isArray(n.grid)||!n.economy||typeof n.economy!="object"||typeof n.playerId!="string"||typeof n.rngState!="number")return!1;const o=n.grid;if(o.length!==D)return!1;for(const a of o)if(!Array.isArray(a)||a.length!==C)return!1;const r=n.economy;return!(typeof r.cash!="number"||!Number.isFinite(r.cash))}function ao(e){return!e||typeof e!="object"?!1:e.version==="2.0.0"}function Ge(e){try{const n=e.state;for(const o of n.grid)for(const r of o)r.crop&&r.crop.chillHoursAccumulated===void 0&&(r.crop.chillHoursAccumulated=0);return n}catch{return null}}function io(e){return!e||typeof e!="object"?!1:e.version==="1.0.0"}function so(e){try{const n=e.state;n.economy.debt===void 0&&(n.economy.debt=0),n.economy.totalLoansReceived===void 0&&(n.economy.totalLoansReceived=0),n.economy.interestPaidThisYear===void 0&&(n.economy.interestPaidThisYear=0),n.eventLog||(n.eventLog=[]),n.activeEvent===void 0&&(n.activeEvent=null),n.pendingForeshadows||(n.pendingForeshadows=[]),n.activeEffects||(n.activeEffects=[]),n.cropFailureStreak===void 0&&(n.cropFailureStreak=0),n.flags||(n.flags={}),n.wateringRestricted===void 0&&(n.wateringRestricted=!1),n.wateringRestrictionEndsDay===void 0&&(n.wateringRestrictionEndsDay=0),n.irrigationCostMultiplier===void 0&&(n.irrigationCostMultiplier=1),n.eventRngState===void 0&&(n.eventRngState=Mt.seed+On);for(const o of n.grid)for(const r of o)r.crop&&(r.crop.isPerennial===void 0&&(r.crop.isPerennial=!1),r.crop.perennialAge===void 0&&(r.crop.perennialAge=0),r.crop.perennialEstablished===void 0&&(r.crop.perennialEstablished=!1),r.crop.isDormant===void 0&&(r.crop.isDormant=!1),r.crop.harvestedThisSeason===void 0&&(r.crop.harvestedThisSeason=!1));return n}catch{return null}}function lo(e){return!e||typeof e!="object"?!1:e.version==="3.0.0"}function pe(e){try{const n=e.state;for(const o of n.grid)for(const r of o)r.coverCropId===void 0&&(r.coverCropId=null);return n.frostProtectionEndsDay===void 0&&(n.frostProtectionEndsDay=0),n}catch{return null}}let _=null;const T=V(null),de=V("new-game"),O=V(null),G=V(!1),E=V(null),j=V(oo()?-1:0),Ze=V(null),Ee=V(null);function P(){_?T.value=structuredClone(_):T.value=null}H(()=>T.value?.calendar.totalDay??0);H(()=>T.value?.economy.cash??0);H(()=>T.value?.speed??0);H(()=>(T.value?.speed??0)===0);H(()=>T.value?.gameOver??!1);const Wr=H(()=>T.value?.autoPauseQueue??[]);H(()=>(T.value?.autoPauseQueue.length??0)>0);const Ur=H(()=>T.value?.notifications??[]);H(()=>T.value?.yearEndSummaryPending??!1);const Yr=H(()=>{const e=T.value,t=O.value;return!e||!t?null:e.grid[t.row]?.[t.col]??null}),co=H(()=>{const e=T.value;return e?Pr(e):[]}),jr=H(()=>T.value?.grid??[]);function Gr(e){const t=e.trim().slice(0,30);t&&(_=tr(t,Mt),Et(_),_e(()=>{P(),de.value="playing",O.value=null,G.value=!1,E.value=null,Ze.value=null,Ee.value=null,j.value=oo()?-1:0}))}function Vr(){const e=Ir();e&&(_=e,Et(_),_e(()=>{P(),de.value="playing",O.value=null,G.value=!1,E.value=null,Ee.value=null,j.value=-1}))}function qr(){return Lr()}function Kr(){return Nr()}function vt(){uo(),_=null,_e(()=>{P(),de.value="new-game",O.value=null,G.value=!1,E.value=null,Ze.value=null})}function Q(e){if(!_)return{success:!1,reason:"No active game."};const t=Y(_,e);return P(),t}function mt(e,t){const n=O.value;n&&n.row===e&&n.col===t?_e(()=>{O.value=null,G.value=!1}):_e(()=>{O.value={row:e,col:t},G.value=!1})}function zr(){G.value=!0}function an(){G.value=!1}function Qr(e){const t=O.value;if(!t)return;Q({type:"PLANT_CROP",cellRow:t.row,cellCol:t.col,cropId:e}).success&&(G.value=!1)}function rt(e,t,n){if(!_)return;if(e==="all"){const r=R(t);if(_.grid.flat().filter(f=>f.crop===null).length===0)return;const i=[];for(let f=0;f<D;f++){const u=_.grid[f].filter(p=>p.crop===null);u.length===C&&i.push(...u)}if(i.length===0)return;const s=r.seedCostPerAcre,d=i.length*s;if(_.economy.cash>=d){E.value={message:`Plant all ${i.length} plots with ${r.name} for $${d.toLocaleString()}?`,onConfirm:()=>{_&&(Y(_,{type:"PLANT_BULK",scope:"all",cropId:t}),E.value=null,P())},onCancel:()=>{E.value=null}};return}const c=Y(_,{type:"PLANT_BULK",scope:e,cropId:t});if(c.partialOffer){const f=c.partialOffer;E.value={message:`You can afford to plant ${f.affordableRows} full row${f.affordableRows>1?"s":""} (${f.affordablePlots} plots) for $${f.totalCost.toLocaleString()}. Plant ${f.affordableRows} row${f.affordableRows>1?"s":""}?`,onConfirm:()=>{if(!_)return;const u=[];let p=0;for(let v=0;v<D&&p<f.affordableRows;v++){const b=_.grid[v].filter(S=>S.crop===null);b.length===C&&(u.push(...b),p++)}_t(_,u,t,s),E.value=null,P()},onCancel:()=>{E.value=null}};return}P();return}Y(_,{type:"PLANT_BULK",scope:e,cropId:t,index:n}).success&&P()}function Le(e,t){Q({type:"HARVEST_BULK",scope:e,index:t})}function Ne(e,t){if(!_)return;if(e==="all"){const o=_.grid.flat().filter(d=>d.crop!==null);if(o.length===0){Y(_,{type:"WATER",scope:e}),P();return}const r=At(_),a=Qe*r,i=o.length*a;if(_.economy.cash>=i){E.value={message:`Water all ${o.length} planted plots for $${i.toLocaleString()}?`,onConfirm:()=>{_&&(Y(_,{type:"WATER",scope:"all"}),E.value=null,P())},onCancel:()=>{E.value=null}};return}const s=Y(_,{type:"WATER",scope:e});if(s.partialOffer){const d=s.partialOffer;E.value={message:`You can afford to water ${d.affordableRows} row${d.affordableRows>1?"s":""} (${d.affordablePlots} plots) for $${d.totalCost.toLocaleString()}. Water ${d.affordableRows} row${d.affordableRows>1?"s":""}?`,onConfirm:()=>{if(!_)return;const c=[];let f=0;for(let u=0;u<D&&f<d.affordableRows;u++){const p=_.grid[u].filter(v=>v.crop!==null);p.length>0&&(c.push(...p),f++)}Gn(_,c),E.value=null,P()},onCancel:()=>{E.value=null}};return}P();return}Y(_,{type:"WATER",scope:e,index:t}).success&&P()}function at(e,t,n){if(!_)return;if(e==="all"){const r=ve(t),a=[];for(let d=0;d<D;d++)for(let c=0;c<C;c++){const f=_.grid[d][c];!f.coverCropId&&sn(f)&&a.push(f)}if(a.length===0)return;const i=a.length*r.seedCostPerAcre;if(_.economy.cash>=i){E.value={message:`Plant cover crops on all ${a.length} eligible plots for $${i.toLocaleString()}?`,onConfirm:()=>{_&&(Y(_,{type:"SET_COVER_CROP_BULK",scope:"all",coverCropId:t}),E.value=null,P())},onCancel:()=>{E.value=null}};return}const s=Y(_,{type:"SET_COVER_CROP_BULK",scope:e,coverCropId:t});if(s.partialOffer){const d=s.partialOffer,c=r.seedCostPerAcre;E.value={message:`You can afford to cover ${d.affordableRows} row${d.affordableRows>1?"s":""} (${d.affordablePlots} plots) for $${d.totalCost.toLocaleString()}. Plant cover crops on ${d.affordableRows} row${d.affordableRows>1?"s":""}?`,onConfirm:()=>{if(!_)return;const f=[];let u=0;for(let p=0;p<D&&u<d.affordableRows;p++){const v=_.grid[p].filter(b=>!b.coverCropId&&sn(b));v.length>0&&(f.push(...v),u++)}pr(_,f,t,c),E.value=null,P()},onCancel:()=>{E.value=null}};return}P();return}Y(_,{type:"SET_COVER_CROP_BULK",scope:e,coverCropId:t,index:n}).success&&P()}function sn(e){return e.crop?e.crop.isPerennial?(R(e.crop.cropId).dormantSeasons?.length??0)>0:!1:!0}function Z(){_&&(Dr(_),_.yearEndSummaryPending&&_.autoPauseQueue.length===0&&wr(_),_.gameOver&&_.autoPauseQueue.length===0&&(de.value="game-over"),P())}function Jr(e){_&&($r(_,e),P())}function Xr(){const e=j.value;e>=2?j.value=-1:j.value=e+1}function ln(){j.value=-1}function cn(e){Hr(),j.value=-1}function Zr(){if(!_)return;eo(_);const e=_.calendar,t=je(e.season),n=`Year ${e.year} ${t}`,o=xr(_,n);o.success?(Ee.value=null,U(_,"info","Game saved."),P()):Ee.value=o.error??"Failed to save game."}function ea(e){const t=Br(e);t&&(_=t,Et(_),_e(()=>{P(),de.value="playing",O.value=null,G.value=!1,E.value=null,Ee.value=null,j.value=-1}))}function ta(e){Fr(e)}function un(){return Or()}let ie=null,yt=0,Ce=0,dn=-1;const na=12;function oa(){ie===null&&(yt=performance.now(),Ce=0,ie=requestAnimationFrame(gt))}function uo(){ie!==null&&(cancelAnimationFrame(ie),ie=null)}function gt(e){if(!_||de.value!=="playing"){ie=requestAnimationFrame(gt);return}const t=_.speed;if(t>0&&_.autoPauseQueue.length===0&&!_.gameOver){const n=Math.min(e-yt,100),o=na*t;Ce+=n/1e3*o;const r=Math.ceil(o/30);let a=0,i=null;for(;Ce>=1&&a<r;){const s=_.calendar.totalDay,d=mr(_,Mt);if(d&&(i=d),a++,Ce--,Wn(s,_.calendar.totalDay)&&_.calendar.totalDay!==dn&&(dn=_.calendar.totalDay,eo(_)),_.autoPauseQueue.length>0||_.gameOver){Ce=0;break}}a>0&&(i&&(Ze.value=i),P())}yt=e,ie=requestAnimationFrame(gt)}window.__gameDebug={setCash(e){_&&(_.economy.cash=e,P())},setDay(e){_&&(_.calendar=ce(e),P())},setDebt(e){_&&(_.economy.debt=e,P())},setTotalLoansReceived(e){_&&(_.economy.totalLoansReceived=e,P())},setFlag(e,t){_&&(_.flags[e]=t,P())},triggerEvent(e){if(!_)return!1;const t=Hn.find(n=>n.id===e);return t?(_.activeEvent={storyletId:t.id,title:t.title,description:t.description,choices:t.choices,firedOnDay:_.calendar.totalDay},_.speed=0,_.autoPauseQueue.push({reason:t.type==="advisor"?"advisor":"event",message:t.title}),P(),!0):!1},getState(){return _},publish(){P()}};const ra="_screen_1dj8x_1",aa="_title_1dj8x_11",ia="_subtitle_1dj8x_18",sa="_form_1dj8x_25",la="_label_1dj8x_34",ca="_input_1dj8x_41",ua="_validation_1dj8x_59",da="_charCount_1dj8x_65",fa="_buttonGroup_1dj8x_71",pa="_startBtn_1dj8x_78",ha="_resumeBtn_1dj8x_91",_a="_loadToggleBtn_1dj8x_103",va="_loadSection_1dj8x_117",ma="_loadTitle_1dj8x_129",ya="_saveEntry_1dj8x_137",ga="_saveInfo_1dj8x_147",ba="_saveName_1dj8x_154",wa="_saveTimestamp_1dj8x_163",Ca="_saveActions_1dj8x_168",Sa="_loadBtn_1dj8x_174",$a="_deleteBtn_1dj8x_185",A={screen:ra,title:aa,subtitle:ia,form:sa,label:la,input:ca,validation:ua,charCount:da,buttonGroup:fa,startBtn:pa,resumeBtn:ha,loadToggleBtn:_a,loadSection:va,loadTitle:ma,saveEntry:ya,saveInfo:ga,saveName:ba,saveTimestamp:wa,saveActions:Ca,loadBtn:Sa,deleteBtn:$a};function it(){const[e,t]=we(""),[n,o]=we(""),[r,a]=we(!1),[i,s]=we([]),d=qr(),c=Kr();function f(m){const W=m.target.value.slice(0,30);t(W),n&&W.trim().length>0&&o("")}function u(){const m=e.trim();if(!m){o("Please enter a Player ID to get started.");return}Gr(m)}function p(m){m.key==="Enter"&&u()}function v(){Vr()}function b(){r||s(un()),a(!r)}function S(m){ea(m)}function w(m){ta(m);const I=un();s(I),I.length===0&&a(!1)}function g(m){return new Date(m).toLocaleString()}return l("div",{class:A.screen,children:[l("h1",{class:A.title,children:"Climate Farmer"}),l("p",{class:A.subtitle,children:"Manage a San Joaquin Valley farm through 30 years of changing climate. Plant crops, manage water, and keep your farm profitable."}),l("div",{class:A.form,children:[l("label",{class:A.label,for:"player-id-input",children:"Player ID"}),l("input",{id:"player-id-input","data-testid":"newgame-player-id",class:A.input,type:"text",value:e,onInput:f,onKeyDown:p,placeholder:"e.g. P3-14 or Team Blue",maxLength:30,"aria-label":"Player ID","aria-describedby":n?"player-id-validation":void 0,autoFocus:!0}),e.length>=25&&l("span",{class:A.charCount,children:[e.length,"/30"]}),l("div",{id:"player-id-validation",class:A.validation,role:"alert","aria-live":"polite",children:n}),l("div",{class:A.buttonGroup,children:[l("button",{"data-testid":"newgame-start",class:A.startBtn,onClick:u,children:"Start New Game"}),d&&l("button",{"data-testid":"save-resume",class:A.resumeBtn,onClick:v,children:"Continue Saved Game"}),c&&l("button",{"data-testid":"save-load-toggle",class:A.loadToggleBtn,onClick:b,children:r?"Hide Saved Games":"Load Game"})]}),r&&i.length>0&&l("div",{class:A.loadSection,"data-testid":"save-load-menu",children:[l("div",{class:A.loadTitle,children:"Saved Games"}),i.map(m=>l("div",{class:A.saveEntry,children:[l("div",{class:A.saveInfo,children:[l("span",{class:A.saveName,children:m.slotName}),l("span",{class:A.saveTimestamp,children:g(m.timestamp)})]}),l("div",{class:A.saveActions,children:[l("button",{"data-testid":`save-load-${m.slotName}`,class:A.loadBtn,onClick:()=>S(m.slotName),children:"Load"}),l("button",{"data-testid":`save-delete-${m.slotName}`,class:A.deleteBtn,onClick:()=>w(m.slotName),children:"Delete"})]})]},m.slotName))]})]})]})}const Da="_topbar_pgzve_1",Pa="_dateSection_pgzve_13",ka="_seasonIcon_pgzve_19",Ea="_weatherSection_pgzve_29",Ta="_weatherIcon_pgzve_37",Ra="_speedControls_pgzve_41",Aa="_speedBtn_pgzve_47",Ma="_speedBtnActive_pgzve_60",xa="_cashSection_pgzve_65",Ia="_cashUp_pgzve_75",Ba="_cashDown_pgzve_79",La="_debtSection_pgzve_83",Na="_saveBtn_pgzve_94",Oa="_newGameBtn_pgzve_106",N={topbar:Da,dateSection:Pa,seasonIcon:ka,weatherSection:Ea,weatherIcon:Ta,speedControls:Ra,speedBtn:Aa,speedBtnActive:Ma,cashSection:xa,cashUp:Ia,cashDown:Ba,debtSection:La,saveBtn:Na,newGameBtn:Oa},Fa={spring:"🌱",summer:"☀️",fall:"🍂",winter:"❄️"};function Ha(e){return e?e.isHeatwave?{icon:"🔥",text:`${Math.round(e.tempHigh)}°F Heat!`}:e.isFrost?{icon:"🧊",text:`${Math.round(e.tempLow)}°F Frost`}:e.precipitation>0?{icon:"🌧️",text:`${Math.round(e.tempHigh)}°F Rain`}:e.tempHigh>100?{icon:"🌡️",text:`${Math.round(e.tempHigh)}°F Hot`}:{icon:"⛅",text:`${Math.round(e.tempHigh)}°F`}:{icon:"",text:""}}function Wa(){const e=T.value;if(!e)return null;const{calendar:t,speed:n,economy:o}=e,r=Ze.value,a=Ha(r),i=se(o.cash),s=se(null);J(()=>{const f=i.current;if(f!==o.cash&&s.current){const u=o.cash>f?N.cashUp:N.cashDown;s.current.classList.add(u);const p=setTimeout(()=>s.current?.classList.remove(u),600);return i.current=o.cash,()=>clearTimeout(p)}},[o.cash]);function d(f){Q({type:"SET_SPEED",speed:f})}const c=[{speed:0,label:"⏸",testId:"speed-pause",ariaLabel:`Pause — currently ${n===0?"paused":`playing at ${n}x speed`}`},{speed:1,label:"▶",testId:"speed-play",ariaLabel:`Play 1x — currently ${n===0?"paused":`playing at ${n}x speed`}`},{speed:2,label:"▶▶",testId:"speed-fast",ariaLabel:`Fast 2x — currently ${n===0?"paused":`playing at ${n}x speed`}`},{speed:4,label:"▶▶▶",testId:"speed-fastest",ariaLabel:`Fastest 4x — currently ${n===0?"paused":`playing at ${n}x speed`}`}];return l("header",{class:N.topbar,role:"banner",children:[l("div",{class:N.dateSection,children:[l("span",{class:N.seasonIcon,"data-testid":"topbar-season-icon","aria-hidden":"true",children:Fa[t.season]??""}),l("span",{"data-testid":"topbar-date","aria-label":`${ne(t.month)} Year ${t.year}, ${je(t.season)}`,children:[je(t.season)," — ",ne(t.month),", Year ",t.year]})]}),r&&l("div",{class:N.weatherSection,"aria-label":`Weather: ${a.text}`,children:[l("span",{class:N.weatherIcon,"aria-hidden":"true",children:a.icon}),l("span",{children:a.text})]}),l("div",{class:N.speedControls,role:"group","aria-label":"Simulation speed controls",children:c.map(f=>l("button",{"data-testid":f.testId,class:`${N.speedBtn} ${n===f.speed?N.speedBtnActive:""}`,onClick:()=>d(f.speed),"aria-label":f.ariaLabel,"aria-pressed":n===f.speed,children:f.label},f.testId))}),l("span",{ref:s,class:N.cashSection,"data-testid":"topbar-cash","aria-label":`Cash: $${Math.floor(o.cash).toLocaleString()}`,children:["$",Math.floor(o.cash).toLocaleString()]}),o.debt>0&&l("span",{class:N.debtSection,"data-testid":"topbar-debt","aria-label":`Debt: $${Math.floor(o.debt).toLocaleString()}`,children:["Debt: $",Math.floor(o.debt).toLocaleString()]}),l("button",{"data-testid":"save-button",class:N.saveBtn,onClick:()=>Zr(),"aria-label":"Save game",children:"Save"}),l("button",{"data-testid":"save-new-game",class:N.newGameBtn,onClick:()=>vt(),"aria-label":"Return to title screen",children:"New Game"})]})}const Ua="_cell_nrs1r_1",Ya="_seedling_nrs1r_18",ja="_vegetative_nrs1r_19",Ga="_flowering_nrs1r_20",Va="_mature_nrs1r_21",qa="_harvestable_nrs1r_22",Ka="_overripe_nrs1r_27",za="_selected_nrs1r_33",Qa="_moistureWarning_nrs1r_44",Ja="_moistureCritical_nrs1r_55",Xa="_dormant_nrs1r_67",Za="_cropIcon_nrs1r_73",ei="_coverCropIcon_nrs1r_78",ti="_progressBar_nrs1r_89",K={cell:Ua,seedling:Ya,vegetative:ja,flowering:Ga,mature:Va,harvestable:qa,"pulse-gold":"_pulse-gold_nrs1r_1",overripe:Ka,selected:za,moistureWarning:Qa,moistureCritical:Ja,dormant:Xa,cropIcon:Za,coverCropIcon:ei,progressBar:ti},ni={"processing-tomatoes":{seedling:"🌱",vegetative:"🪴",flowering:"🌻",mature:"🍅",harvestable:"🍅",overripe:"🍅"},"silage-corn":{seedling:"🌱",vegetative:"🪴",flowering:"🌾",mature:"🌽",harvestable:"🌽",overripe:"🌽"},"winter-wheat":{seedling:"🌱",vegetative:"🪴",flowering:"🌾",mature:"🌾",harvestable:"🌾",overripe:"🌾"},almonds:{seedling:"🌳",vegetative:"🌳",flowering:"🌸",mature:"🌳",harvestable:"🥜",overripe:"🥜"},pistachios:{seedling:"🌳",vegetative:"🌳",flowering:"🌸",mature:"🌳",harvestable:"🥜",overripe:"🥜"},sorghum:{seedling:"🌱",vegetative:"🪴",flowering:"🌾",mature:"🌾",harvestable:"🌾",overripe:"🌾"},"citrus-navels":{seedling:"🌳",vegetative:"🌳",flowering:"🌸",mature:"🌳",harvestable:"🍊",overripe:"🍊"}};function oi({cell:e}){const{row:t,col:n,crop:o,soil:r,coverCropId:a}=e,i=O.value?.row===t&&O.value?.col===n,s=o?K[o.growthStage]??"":"",d=r.moistureCapacity>0?r.moisture/r.moistureCapacity:0,c=o&&d<Lo?K.moistureCritical:o&&d<Bo?K.moistureWarning:"",f=o?o.isDormant?"🪵":ni[o.cropId]?.[o.growthStage]??"🌱":"",u=o?.isDormant?K.dormant:"",p=o?Jn(o):0,v=o?R(o.cropId):null,b=o?`Row ${t+1}, Column ${n+1}: ${v.name}, ${o.growthStage} stage, nitrogen ${Math.round(r.nitrogen)}, moisture ${Math.round(r.moisture*10)/10}`:`Row ${t+1}, Column ${n+1}: Empty plot, nitrogen ${Math.round(r.nitrogen)}, moisture ${Math.round(r.moisture*10)/10}`;function S(){mt(t,n)}function w(g){(g.key==="Enter"||g.key===" ")&&(g.preventDefault(),mt(t,n))}return l("button",{"data-testid":`farm-cell-${t}-${n}`,class:`${K.cell} ${s} ${c} ${u} ${i?K.selected:""}`,onClick:S,onKeyDown:w,role:"gridcell","aria-label":b,"aria-selected":i,tabIndex:t===0&&n===0?0:-1,children:[f&&l("span",{class:K.cropIcon,"aria-hidden":"true",children:f}),a&&l("span",{"data-testid":`farm-cell-cover-${t}-${n}`,class:K.coverCropIcon,"aria-hidden":"true",children:"☘"}),o&&!o.isDormant&&o.growthStage!=="harvestable"&&o.growthStage!=="overripe"&&l("div",{class:K.progressBar,style:{width:`${p*100}%`}})]})}const ri="_gridContainer_1qn5u_1",ai="_grid_1qn5u_1",ii="_emptyFieldHint_1qn5u_17",si="_gridWrapper_1qn5u_28",xe={gridContainer:ri,grid:ai,emptyFieldHint:ii,gridWrapper:si};function li(){const e=jr.value,t=e.every(o=>o.every(r=>r.crop===null)),n=Co(o=>{const r=O.value;if(!r)return;let{row:a,col:i}=r,s=!1;switch(o.key){case"ArrowUp":a>0&&(a--,s=!0);break;case"ArrowDown":a<D-1&&(a++,s=!0);break;case"ArrowLeft":i>0&&(i--,s=!0);break;case"ArrowRight":i<C-1&&(i++,s=!0);break}s&&(o.preventDefault(),mt(a,i),document.querySelector(`[data-testid="farm-cell-${a}-${i}"]`)?.focus())},[]);return l("div",{class:xe.gridContainer,children:l("div",{class:xe.gridWrapper,children:[l("div",{class:xe.grid,"data-testid":"farm-grid",role:"grid","aria-label":"Farm field - 8 rows by 8 columns",onKeyDown:n,children:e.map((o,r)=>o.map((a,i)=>l(oi,{cell:a},`${r}-${i}`)))}),t&&l("div",{class:xe.emptyFieldHint,"aria-live":"polite",children:"Select a plot and plant your first crop!"})]})})}const ci="_menu_n7xlc_1",ui="_cropOption_n7xlc_8",di="_cropName_n7xlc_32",fi="_cropCost_n7xlc_36",pi="_cancelBtn_n7xlc_41",hi="_disabledReason_n7xlc_54",_i="_perennialWarning_n7xlc_60",re={menu:ci,cropOption:ui,cropName:di,cropCost:fi,cancelBtn:pi,disabledReason:hi,perennialWarning:_i};function vi(e){const t=T.value,n=se(null);if(J(()=>{function i(s){s.key==="Escape"&&an()}return document.addEventListener("keydown",i),()=>document.removeEventListener("keydown",i)},[]),J(()=>{n.current?.querySelector("button:not(:disabled)")?.focus()},[]),!t)return null;const o=Fn(),r=t.calendar.month,a=t.economy.cash;return l("div",{class:re.menu,ref:n,role:"listbox","aria-label":"Select a crop to plant",children:[o.map(i=>{const s=R(i),d=Je(r,s.plantingWindow.startMonth,s.plantingWindow.endMonth),c=a>=s.seedCostPerAcre,f=!d||!c;let u="";d?c||(u=`Cost: $${s.seedCostPerAcre}. Available: $${Math.floor(a)}.`):u=`Planting window: ${ne(s.plantingWindow.startMonth)}–${ne(s.plantingWindow.endMonth)}`;const p=s.type==="perennial";return l("div",{children:[l("button",{"data-testid":`menu-crop-${i}`,class:re.cropOption,onClick:()=>Qr(i),disabled:f,role:"option","aria-label":f?`${s.name} — $${s.seedCostPerAcre}/plot — ${u}`:`${s.name} — $${s.seedCostPerAcre}/plot`,title:f?u:s.shortDescription,children:[l("span",{class:re.cropName,children:s.name}),l("span",{class:re.cropCost,children:["$",s.seedCostPerAcre,"/plot"]})]}),f&&l("div",{class:re.disabledReason,children:u}),!f&&p&&s.yearsToEstablish&&l("div",{class:re.perennialWarning,children:["Takes ",s.yearsToEstablish," years before first harvest"]})]},i)}),l("button",{"data-testid":"menu-cancel",class:re.cancelBtn,onClick:()=>an(),children:"Cancel"})]})}const mi="_panel_1pp0j_1",yi="_section_1pp0j_12",gi="_sectionTitle_1pp0j_17",bi="_cellDetail_1pp0j_27",wi="_cropName_1pp0j_33",Ci="_cropStage_1pp0j_39",Si="_overripeWarning_1pp0j_44",$i="_soilRow_1pp0j_51",Di="_soilLabel_1pp0j_58",Pi="_barContainer_1pp0j_65",ki="_barFill_1pp0j_74",Ei="_soilValue_1pp0j_80",Ti="_growthBar_1pp0j_89",Ri="_growthLabel_1pp0j_93",Ai="_growthBarContainer_1pp0j_99",Mi="_growthBarFill_1pp0j_106",xi="_actions_1pp0j_114",Ii="_actionBtn_1pp0j_120",Bi="_actionBtnPrimary_1pp0j_135",Li="_actionBtnHarvest_1pp0j_145",Ni="_actionBtnWater_1pp0j_155",Oi="_fieldSummary_1pp0j_166",Fi="_summaryRow_1pp0j_172",Hi="_tooltip_1pp0j_179",Wi="_cropDescription_1pp0j_186",Ui="_perennialInfo_1pp0j_194",Yi="_perennialLabel_1pp0j_204",ji="_perennialEstablishing_1pp0j_215",Gi="_perennialPhase_1pp0j_221",Vi="_perennialDeclineInfo_1pp0j_227",qi="_chillInfo_1pp0j_234",Ki="_chillLabel_1pp0j_242",zi="_chillBarContainer_1pp0j_249",Qi="_chillBarFill_1pp0j_258",Ji="_chillValue_1pp0j_265",Xi="_chillWarning_1pp0j_271",Zi="_actionBtnRemove_1pp0j_279",es="_actionBtnCover_1pp0j_290",ts="_coverCropStatus_1pp0j_301",h={panel:mi,section:yi,sectionTitle:gi,cellDetail:bi,cropName:wi,cropStage:Ci,overripeWarning:Si,soilRow:$i,soilLabel:Di,barContainer:Pi,barFill:ki,soilValue:Ei,growthBar:Ti,growthLabel:Ri,growthBarContainer:Ai,growthBarFill:Mi,actions:xi,actionBtn:Ii,actionBtnPrimary:Bi,actionBtnHarvest:Li,actionBtnWater:Ni,fieldSummary:Oi,summaryRow:Fi,tooltip:Hi,cropDescription:Wi,perennialInfo:Ui,perennialLabel:Yi,perennialEstablishing:ji,perennialPhase:Gi,perennialDeclineInfo:Vi,chillInfo:qi,chillLabel:Ki,chillBarContainer:zi,chillBarFill:Qi,chillValue:Ji,chillWarning:Xi,actionBtnRemove:Zi,actionBtnCover:es,coverCropStatus:ts};function ns(){if(!T.value)return null;const t=O.value,n=Yr.value;return l("aside",{class:h.panel,role:"complementary","aria-label":"Farm details",children:[n?l(os,{cell:n,row:t.row,col:t.col}):l(as,{}),l(is,{})]})}function os({cell:e,row:t,col:n}){const{crop:o,soil:r,coverCropId:a}=e,i=o?R(o.cropId):null,s=G.value,d=co.value,c=T.value,f=!o&&d.length>0,u=o&&(o.growthStage==="harvestable"||o.growthStage==="overripe"),p=o?.isPerennial===!0,v=c?.calendar.season==="fall",b=o?.isPerennial&&i?.dormantSeasons&&i.dormantSeasons.length>0,S=v&&!a&&(!o||b),w=o?Jn(o):0,g=o?kr(o):0;let m="";if(o){const L=Math.round(w*100);if(o.isDormant)m="Dormant — waiting for spring";else if(o.growthStage==="harvestable")m="Ready to harvest!";else if(o.growthStage==="overripe"){const q=o.isPerennial?"yield lost this year":"crop loss";m=`Overripe — yield declining. ${o.overripeDaysRemaining} days until ${q}.`}else m=`${o.growthStage.charAt(0).toUpperCase()+o.growthStage.slice(1)} — ${L}% grown`}let I="";o&&!u&&(I=`${i?.name} — ${Math.round(w*100)}% grown.`);function W(){zr()}function oe(){Q({type:"HARVEST",cellRow:t,cellCol:n})}function Te(){const L=i?.removalCost??0;E.value={message:`Remove ${i?.name}? This will permanently clear this plot. Cost: $${L}.`,onConfirm:()=>{Q({type:"REMOVE_CROP",cellRow:t,cellCol:n}),E.value=null},onCancel:()=>{E.value=null}}}return l("div",{"data-testid":"sidebar-cell-detail",children:[l("div",{class:h.section,children:[l("div",{class:h.sectionTitle,children:["Plot (Row ",t+1,", Col ",n+1,")"]}),l("div",{class:h.cellDetail,children:[l("span",{"data-testid":"sidebar-crop-name",class:h.cropName,children:i?i.name:"Empty"}),o&&l(ee,{children:[l("span",{class:h.cropStage,children:m}),o.growthStage==="overripe"&&l("span",{class:h.overripeWarning,children:["Yield: ",Math.round(g),"% of maximum. Harvest now or lose it in ",o.overripeDaysRemaining," days."]}),!o.isDormant&&l("div",{"data-testid":"sidebar-crop-growth",class:h.growthBar,children:[l("div",{class:h.growthLabel,children:"Growth Progress"}),l("div",{class:h.growthBarContainer,children:l("div",{class:h.growthBarFill,style:{width:`${Math.min(100,w*100)}%`}})})]}),o.isPerennial&&i&&l("div",{"data-testid":"sidebar-perennial-status",class:h.perennialInfo,children:[o.perennialEstablished?l(ee,{children:[l("span",{"data-testid":"sidebar-perennial-age",class:h.perennialLabel,children:[o.isDormant?"Dormant":"Producing"," — Year ",o.perennialAge," of ",i.productiveLifespan??"?"]}),l("span",{"data-testid":"sidebar-perennial-phase",class:h.perennialPhase,children:[ot(o,i),i.yieldCurve&&(()=>{const L=qn(o,i);return L<1?` (${Math.round(L*100)}%)`:null})()]}),i.yieldCurve&&(()=>{const L=o.perennialAge-(i.yearsToEstablish??0),q=ot(o,i);if(q==="Peak Production"&&i.yieldCurve.declineStartYear>L){const F=i.yieldCurve.declineStartYear-L;return l("span",{"data-testid":"sidebar-perennial-decline-info",class:h.perennialDeclineInfo,children:[F," year",F!==1?"s":""," until decline"]})}return q==="Declining"||q==="Past Prime"?l("span",{"data-testid":"sidebar-perennial-decline-info",class:h.perennialDeclineInfo,children:"Replacement recommended"}):null})()]}):l(ee,{children:[l("span",{"data-testid":"sidebar-perennial-age",class:h.perennialLabel,children:[o.isDormant?"Dormant":"Establishing"," — Year ",o.perennialAge,"/",i.yearsToEstablish??"?"]}),l("span",{"data-testid":"sidebar-perennial-phase",class:h.perennialPhase,children:ot(o,i)})]}),!o.perennialEstablished&&i.yearsToEstablish&&!o.isDormant&&l("span",{class:h.perennialEstablishing,children:[i.yearsToEstablish-o.perennialAge," year",i.yearsToEstablish-o.perennialAge!==1?"s":""," until first harvest"]}),T.value?.flags.chillHoursRevealed&&i.chillHoursRequired!==void 0&&i.chillHoursRequired>0&&l(rs,{accumulated:o.chillHoursAccumulated,required:i.chillHoursRequired})]}),i&&l("span",{class:h.cropDescription,children:i.shortDescription})]})]})]}),l("div",{class:h.section,children:[l("div",{class:h.sectionTitle,children:"Soil"}),l(st,{label:"Nitrogen",testId:"sidebar-soil-n",value:r.nitrogen,max:200,unit:"lbs/acre",color:r.nitrogen>=No?"var(--nitrogen-high)":r.nitrogen>=Oo?"var(--nitrogen-medium)":"var(--nitrogen-low)"}),l(st,{label:"Moisture",testId:"sidebar-soil-moisture",value:r.moisture,max:r.moistureCapacity,unit:"in",color:r.moistureCapacity>0&&r.moisture/r.moistureCapacity>.5?"var(--moisture-high)":r.moistureCapacity>0&&r.moisture/r.moistureCapacity>.25?"var(--moisture-medium)":"var(--moisture-critical)"}),l(st,{label:"Organic M.",testId:"sidebar-soil-om",value:r.organicMatter,max:5,unit:"%",color:"var(--color-primary)"})]}),l("div",{class:h.section,children:[l("div",{class:h.sectionTitle,children:"Actions"}),l("div",{class:h.actions,children:[f&&!s&&l("button",{"data-testid":"action-plant",class:`${h.actionBtn} ${h.actionBtnPrimary}`,onClick:W,children:"Plant..."}),!f&&!o&&d.length===0&&l("div",{class:h.tooltip,children:"No crops available this season."}),o&&!f&&l("div",{class:h.tooltip,children:"This plot already has a crop."}),s&&l(vi,{row:t,col:n}),l("button",{"data-testid":"action-harvest",class:`${h.actionBtn} ${u?h.actionBtnHarvest:""}`,onClick:oe,disabled:!u,"aria-label":u?"Harvest this plot":I,title:u?void 0:I,children:"Harvest"}),p&&l("button",{"data-testid":"action-remove-crop",class:`${h.actionBtn} ${h.actionBtnRemove}`,onClick:Te,children:["Remove ",i?.name," ($",i?.removalCost??0,")"]}),S&&l("button",{"data-testid":"action-plant-cover-crop",class:`${h.actionBtn} ${h.actionBtnCover}`,onClick:()=>Q({type:"SET_COVER_CROP",cellRow:t,cellCol:n,coverCropId:"legume-cover"}),children:"Plant Cover Crop ($30)"}),a&&l("div",{"data-testid":"sidebar-cover-crop-status",class:h.coverCropStatus,children:["Cover Crop: Clover/Vetch Mix",l("button",{"data-testid":"action-remove-cover-crop",class:`${h.actionBtn} ${h.actionBtnRemove}`,onClick:()=>Q({type:"SET_COVER_CROP",cellRow:t,cellCol:n,coverCropId:null}),children:"Remove Cover Crop"})]})]})]})]})}function st({label:e,testId:t,value:n,max:o,unit:r,color:a}){const i=o>0?Math.min(100,n/o*100):0,s=r==="%"?`${n.toFixed(1)}${r}`:`${Math.round(n)} ${r}`;return l("div",{class:h.soilRow,"data-testid":t,children:[l("span",{class:h.soilLabel,children:e}),l("div",{class:h.barContainer,role:"meter","aria-label":`${e}: ${s}`,"aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":o,children:l("div",{class:h.barFill,style:{width:`${i}%`,background:a}})}),l("span",{class:h.soilValue,children:s})]})}function rs({accumulated:e,required:t}){const n=t>0?Math.min(100,e/t*100):100,o=t-e,r=o>0;return l("div",{"data-testid":"sidebar-perennial-chill",class:h.chillInfo,children:[l("span",{class:h.chillLabel,children:"Chill Hours"}),l("div",{class:h.chillBarContainer,children:l("div",{class:h.chillBarFill,style:{width:`${n}%`}})}),l("span",{class:h.chillValue,children:[Math.round(e),"/",t]}),r&&l("span",{class:h.chillWarning,"data-testid":"sidebar-chill-deficit",children:["Deficit: ",Math.round(o)," hrs"]})]})}function as(){const e=T.value;if(!e)return null;let t=0,n=0,o=0,r=0;for(let d=0;d<D;d++)for(let c=0;c<C;c++){const f=e.grid[d][c];f.crop&&(t++,(f.crop.growthStage==="harvestable"||f.crop.growthStage==="overripe")&&n++),o+=f.soil.nitrogen,r+=f.soil.moisture}const a=o/(D*C),i=r/(D*C),s=D*C-t;return l("div",{class:h.section,children:[l("div",{class:h.sectionTitle,children:"Field Summary"}),l("div",{class:h.fieldSummary,children:[l("div",{class:h.summaryRow,children:[l("span",{children:"Planted plots"}),l("span",{children:[t," / ",D*C]})]}),l("div",{class:h.summaryRow,children:[l("span",{children:"Empty plots"}),l("span",{children:s})]}),l("div",{class:h.summaryRow,children:[l("span",{children:"Ready to harvest"}),l("span",{children:n})]}),l("div",{class:h.summaryRow,children:[l("span",{children:"Avg. nitrogen"}),l("span",{children:[Math.round(a)," lbs/acre"]})]}),l("div",{class:h.summaryRow,children:[l("span",{children:"Avg. moisture"}),l("span",{children:[i.toFixed(1)," in"]})]}),l("div",{class:h.summaryRow,children:[l("span",{children:"Revenue (this year)"}),l("span",{children:["$",Math.floor(e.economy.yearlyRevenue).toLocaleString()]})]}),l("div",{class:h.summaryRow,children:[l("span",{children:"Expenses (this year)"}),l("span",{children:["$",Math.floor(e.economy.yearlyExpenses).toLocaleString()]})]})]})]})}function is(){const e=T.value;if(!e)return null;const t=O.value,n=co.value,o=e.grid.some(s=>s.some(d=>d.crop!==null)),r=e.grid.some(s=>s.some(d=>d.crop&&(d.crop.growthStage==="harvestable"||d.crop.growthStage==="overripe"))),i=e.calendar.season==="fall"&&e.grid.some(s=>s.some(d=>d.coverCropId?!1:d.crop?d.crop.isPerennial?(R(d.crop.cropId).dormantSeasons?.length??0)>0:!1:!0));return l("div",{class:h.section,children:[l("div",{class:h.sectionTitle,children:"Bulk Actions"}),l("div",{class:h.actions,children:[n.length>0&&n.map(s=>{const d=R(s);return l("button",{"data-testid":`action-plant-all-${s}`,class:`${h.actionBtn} ${h.actionBtnPrimary}`,onClick:()=>rt("all",s),children:["Plant Field: ",d.name," ($",d.seedCostPerAcre,"/plot)"]},s)}),t&&n.length>0&&n.map(s=>{const d=R(s);return l("button",{"data-testid":`action-plant-row-${t.row}-${s}`,class:`${h.actionBtn} ${h.actionBtnPrimary}`,onClick:()=>rt("row",s,t.row),children:["Plant Row ",t.row+1,": ",d.name]},`row-${s}`)}),t&&n.length>0&&n.map(s=>{const d=R(s);return l("button",{"data-testid":`action-plant-col-${t.col}-${s}`,class:`${h.actionBtn} ${h.actionBtnPrimary}`,onClick:()=>rt("col",s,t.col),children:["Plant Col ",t.col+1,": ",d.name]},`col-${s}`)}),l("button",{"data-testid":"action-harvest-all",class:`${h.actionBtn} ${r?h.actionBtnHarvest:""}`,onClick:()=>Le("all"),disabled:!r,children:"Harvest Field"}),t&&l("button",{"data-testid":`action-harvest-row-${t.row}`,class:`${h.actionBtn} ${r?h.actionBtnHarvest:""}`,onClick:()=>Le("row",t.row),disabled:!r,children:["Harvest Row ",t.row+1]}),t&&l("button",{"data-testid":`action-harvest-col-${t.col}`,class:`${h.actionBtn} ${r?h.actionBtnHarvest:""}`,onClick:()=>Le("col",t.col),disabled:!r,children:["Harvest Col ",t.col+1]}),l("button",{"data-testid":"action-water-all",class:`${h.actionBtn} ${o?h.actionBtnWater:""}`,onClick:()=>Ne("all"),disabled:!o,children:["Water Field ($",Qe,"/plot)"]}),t&&l("button",{"data-testid":`action-water-row-${t.row}`,class:`${h.actionBtn} ${h.actionBtnWater}`,onClick:()=>Ne("row",t.row),disabled:!o,children:["Water Row ",t.row+1]}),t&&l("button",{"data-testid":`action-water-col-${t.col}`,class:`${h.actionBtn} ${h.actionBtnWater}`,onClick:()=>Ne("col",t.col),disabled:!o,children:["Water Col ",t.col+1]}),i&&l("button",{"data-testid":"action-plant-cover-crop-bulk",class:`${h.actionBtn} ${h.actionBtnCover}`,onClick:()=>at("all","legume-cover"),children:"Cover Crop — Field ($30/plot)"}),t&&i&&l("button",{"data-testid":`action-cover-crop-row-${t.row}`,class:`${h.actionBtn} ${h.actionBtnCover}`,onClick:()=>at("row","legume-cover",t.row),children:["Cover Crop — Row ",t.row+1]}),t&&i&&l("button",{"data-testid":`action-cover-crop-col-${t.col}`,class:`${h.actionBtn} ${h.actionBtnCover}`,onClick:()=>at("col","legume-cover",t.col),children:["Cover Crop — Col ",t.col+1]})]})]})}const ss="_bar_s6uk8_1",ls="_message_s6uk8_13",cs="_dismissBtn_s6uk8_22",us="_count_s6uk8_36",ds="_empty_s6uk8_43",be={bar:ss,message:ls,dismissBtn:cs,count:us,empty:ds};function fs(){const e=Ur.value,t=e.length>0?e[e.length-1]:null;return l("div",{class:be.bar,"data-testid":"notify-bar",role:"status","aria-live":"polite","aria-label":"Notifications",children:t?l(ee,{children:[l("span",{class:be.message,children:t.message}),e.length>1&&l("span",{class:be.count,children:["+",e.length-1," more"]}),l("button",{"data-testid":"notify-dismiss",class:be.dismissBtn,onClick:()=>Jr(t.id),"aria-label":"Dismiss notification",children:"Dismiss"})]}):l("span",{class:be.empty,children:" "})})}const ps="_overlay_1mnub_3",hs="_panel_1mnub_13",_s="_panelWide_1mnub_22",vs="_title_1mnub_26",ms="_message_1mnub_33",ys="_buttonRow_1mnub_40",gs="_primaryBtn_1mnub_46",bs="_secondaryBtn_1mnub_58",ws="_dangerBtn_1mnub_70",Cs="_summaryTable_1mnub_83",Ss="_positive_1mnub_105",$s="_negative_1mnub_109",Ds="_report_1mnub_114",Ps="_suggestion_1mnub_124",ks="_tutorialOverlay_1mnub_132",Es="_tooltip_1mnub_142",Ts="_tooltipStep_1mnub_150",Rs="_tooltipStepNumber_1mnub_157",As="_tooltipActions_1mnub_163",Ms="_checkboxLabel_1mnub_169",xs="_advisorHeader_1mnub_179",Is="_advisorIcon_1mnub_188",Bs="_advisorName_1mnub_193",Ls="_advisorRole_1mnub_199",Ns="_choiceList_1mnub_204",Os="_choiceBtn_1mnub_210",Fs="_choiceBtnDisabled_1mnub_232",Hs="_choiceLabel_1mnub_237",Ws="_choiceDesc_1mnub_244",Us="_choiceCost_1mnub_250",Ys="_choiceCostUnaffordable_1mnub_257",y={overlay:ps,panel:hs,panelWide:_s,title:vs,message:ms,buttonRow:ys,primaryBtn:gs,secondaryBtn:bs,dangerBtn:ws,summaryTable:Cs,positive:Ss,negative:$s,report:Ds,suggestion:Ps,tutorialOverlay:ks,tooltip:Es,tooltipStep:Ts,tooltipStepNumber:Rs,tooltipActions:As,checkboxLabel:Ms,advisorHeader:xs,advisorIcon:Is,advisorName:Bs,advisorRole:Ls,choiceList:Ns,choiceBtn:Os,choiceBtnDisabled:Fs,choiceLabel:Hs,choiceDesc:Ws,choiceCost:Us,choiceCostUnaffordable:Ys};function js({event:e,isAdvisor:t}){const n=se(null),r=T.value?.economy.cash??0;J(()=>{n.current?.querySelector("button")?.focus()},[e.storyletId]);function a(s){Q({type:"RESPOND_EVENT",eventId:e.storyletId,choiceId:s.id}).success&&Z()}const i=t?"advisor-panel":"event-panel";return l("div",{class:y.overlay,"data-testid":i,role:"alertdialog","aria-label":e.title,children:l("div",{class:y.panel,ref:n,children:[t&&l("div",{class:y.advisorHeader,children:[l("span",{class:y.advisorIcon,"data-testid":"advisor-portrait","aria-hidden":"true",children:"🧑‍🌾"}),l("div",{children:[l("div",{class:y.advisorName,"data-testid":"advisor-name",children:"Dr. Maria Santos"}),l("div",{class:y.advisorRole,"data-testid":"advisor-role",children:"County Extension Agent"})]})]}),l("h2",{class:y.title,"data-testid":"event-title",children:e.title}),l("div",{class:y.message,"data-testid":"event-description",children:e.description}),l("div",{class:y.choiceList,children:e.choices.map(s=>{const d=s.requiresCash===void 0||r>=s.requiresCash;return l("button",{"data-testid":`${t?"advisor":"event"}-choice-${s.id}`,class:`${y.choiceBtn} ${d?"":y.choiceBtnDisabled}`,onClick:()=>a(s),disabled:!d,"aria-label":`${s.label}${s.cost?` — costs $${s.cost}`:""}${d?"":" (not enough cash)"}`,children:[l("div",{class:y.choiceLabel,children:s.label}),l("div",{class:y.choiceDesc,children:s.description}),s.cost!==void 0&&s.cost>0&&l("div",{class:`${y.choiceCost} ${d?"":y.choiceCostUnaffordable}`,"data-testid":`${t?"advisor":"event"}-choice-cost-${s.id}`,children:["$",s.cost.toLocaleString()]})]},s.id)})})]})})}function Gs(){const e=Wr.value;if(e.length===0)return null;const t=e[0];if(t.reason==="event"||t.reason==="advisor"){const n=T.value;return n?.activeEvent?l(js,{event:n.activeEvent,isAdvisor:t.reason==="advisor"}):l(fn,{event:t})}return l(fn,{event:t})}function fn({event:e}){const t=se(null);J(()=>{t.current?.querySelector("button")?.focus()},[e.reason]);const n=T.value;function o(){switch(e.reason){case"harvest_ready":Le("all"),Z();break;case"water_stress":Ne("all"),Z();break;case"year_end":Z();break;case"bankruptcy":vt();break;case"year_30":vt();break;case"loan_offer":Q({type:"TAKE_LOAN"}),Z();break;case"event":case"advisor":Z();break}}function r(){if(e.reason==="loan_offer"){Z();return}Z()}const a=Vs(e,n),i=e.reason==="bankruptcy"?"gameover-panel":e.reason==="year_30"?"year30-panel":e.reason==="loan_offer"?"loan-panel":e.reason==="event"?"event-panel":e.reason==="advisor"?"advisor-panel":"autopause-panel",s=e.reason==="bankruptcy"?"gameover-new-game":e.reason==="year_30"?"year30-new-game":e.reason==="loan_offer"?"loan-accept":"autopause-action-primary";return l("div",{class:y.overlay,"data-testid":i,role:"alertdialog","aria-label":a.title,children:l("div",{class:`${y.panel} ${a.wide?y.panelWide:""}`,ref:t,children:[l("h2",{class:y.title,children:a.title}),l("div",{class:y.message,children:e.message}),a.summaryData&&l(Ks,{data:a.summaryData}),a.report&&l("div",{"data-testid":"gameover-report",class:y.report,children:a.report}),a.suggestion&&l("div",{class:y.suggestion,children:a.suggestion}),l("div",{class:y.buttonRow,children:[a.secondaryLabel&&l("button",{"data-testid":"autopause-dismiss",class:y.secondaryBtn,onClick:r,children:a.secondaryLabel}),l("button",{"data-testid":s,class:e.reason==="bankruptcy"?y.dangerBtn:y.primaryBtn,onClick:o,children:a.primaryLabel})]})]})})}function Vs(e,t){switch(e.reason){case"harvest_ready":return{title:"Harvest Time!",primaryLabel:"Harvest Field",secondaryLabel:"Continue"};case"water_stress":return{title:"Water Warning",primaryLabel:"Water Field",secondaryLabel:"Continue without watering"};case"year_end":{const n=e.data;return{title:`Year ${n?.year??"?"} Complete`,primaryLabel:`Continue to Year ${(n?.year??0)+1}`,wide:!0,summaryData:n?{revenue:n.revenue,expenses:n.expenses,net:n.netProfit,cash:n.cash}:void 0}}case"bankruptcy":{const n=e.data,o=qs(t);return{title:"Game Over",primaryLabel:"Start New Game",report:n?`Starting cash: $50,000. Total revenue: $${Math.floor(n.yearlyRevenue).toLocaleString()}. Total expenses: $${Math.floor(n.yearlyExpenses).toLocaleString()}.`:void 0,suggestion:o}}case"year_30":return{title:"Congratulations!",primaryLabel:"Start New Game"};case"loan_offer":return{title:"Emergency Loan Offer",primaryLabel:`Accept Loan ($${(e.data?.loanAmount??0).toLocaleString()})`,secondaryLabel:"Decline (Game Over)"};case"event":return{title:e.message||"Event",primaryLabel:"View Details",secondaryLabel:"Dismiss"};case"advisor":return{title:e.message||"Advisor",primaryLabel:"View Details",secondaryLabel:"Dismiss"};default:return{title:"Paused",primaryLabel:"Continue"}}}function qs(e){return e?e.grid.flat().reduce((o,r)=>o+r.soil.nitrogen,0)/64<30?"Tip: Your soil nitrogen was very low. Try rotating crops — plant winter wheat after tomatoes to give the soil a break.":e.grid.flat().reduce((o,r)=>o+r.soil.moisture,0)/64<1?"Tip: Your crops were very thirsty. Try watering more often during hot summer months.":"Tip: Consider diversifying your crops and watching your expenses carefully.":"Try a different strategy next time."}function Ks({data:e}){const t=e.net>=0;return l("table",{class:y.summaryTable,children:l("tbody",{children:[l("tr",{children:[l("td",{children:"Revenue"}),l("td",{class:y.positive,children:["$",Math.floor(e.revenue).toLocaleString()]})]}),l("tr",{children:[l("td",{children:"Expenses"}),l("td",{class:y.negative,children:["-$",Math.floor(e.expenses).toLocaleString()]})]}),l("tr",{children:[l("td",{children:["Net ",t?"Profit":"Loss"]}),l("td",{class:t?y.positive:y.negative,children:[t?"+":"-","$",Math.floor(Math.abs(e.net)).toLocaleString()]})]}),l("tr",{children:[l("td",{children:"Cash Balance"}),l("td",{children:["$",Math.floor(e.cash).toLocaleString()]})]})]})})}function zs(){const e=E.value;return e?l(Qs,{dialog:e}):null}function Qs({dialog:e}){const t=se(null);return J(()=>{t.current?.querySelector("button")?.focus()},[e]),J(()=>{function n(o){o.key==="Escape"&&e.onCancel()}return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[e]),l("div",{class:y.overlay,"data-testid":"confirm-dialog",role:"alertdialog","aria-label":"Confirm action",children:l("div",{class:y.panel,ref:t,children:[l("div",{"data-testid":"confirm-message",class:y.message,children:e.message}),l("div",{class:y.buttonRow,children:[l("button",{"data-testid":"confirm-cancel",class:y.secondaryBtn,onClick:e.onCancel,children:"Cancel"}),l("button",{"data-testid":"confirm-accept",class:y.primaryBtn,onClick:e.onConfirm,children:"Confirm"})]})]})})}const Js=[{number:1,title:"Select a Plot",text:"Click any plot in the field to select it. You'll see its soil details in the side panel."},{number:2,title:"Plant a Crop",text:'With a plot selected, click "Plant..." to choose a crop. Each crop has different costs and growing needs.'},{number:3,title:"Start Time",text:"Press the Play button (▶) to start the simulation. Watch your crops grow day by day!"}];function Xs(){const e=j.value;if(e<0||e>2)return null;const[t,n]=we(!1),o=se(null),r=Js[e];J(()=>{o.current?.querySelector("button")?.focus()},[e]);function a(){e>=2?(t&&cn(),ln()):Xr()}function i(){t&&cn(),ln()}return l("div",{class:y.tutorialOverlay,"data-testid":"tutorial-overlay",children:l("div",{class:y.tooltip,ref:o,role:"dialog","aria-label":"Tutorial","data-testid":"tutorial-step",children:[l("div",{class:y.tooltipStepNumber,children:["Step ",r.number," of 3"]}),l("div",{class:y.tooltipStep,children:[l("strong",{children:r.title}),l("br",{}),r.text]}),l("div",{class:y.tooltipActions,children:[l("label",{class:y.checkboxLabel,children:[l("input",{type:"checkbox","data-testid":"tutorial-dont-show",checked:t,onChange:s=>n(s.target.checked)}),"Don't show again"]}),l("div",{style:{display:"flex",gap:"8px"},children:[l("button",{"data-testid":"tutorial-skip",class:y.secondaryBtn,onClick:i,children:"Skip"}),l("button",{"data-testid":"tutorial-next",class:y.primaryBtn,onClick:a,children:e>=2?"Got it!":"Next"})]})]})]})})}const Zs="_layout_1deg1_1",el="_main_1deg1_7",pn={layout:Zs,main:el};function tl(){J(()=>(oa(),()=>uo()),[]);const e=j.value>=0;return l("div",{class:pn.layout,children:[l(Wa,{}),l("div",{class:pn.main,children:[l(li,{}),l(ns,{})]}),l(fs,{}),l(Gs,{}),l(zs,{}),e&&l(Xs,{})]})}function nl(){switch(de.value){case"new-game":return l(it,{});case"playing":return l(tl,{});case"game-over":return l(it,{});default:return l(it,{})}}go(l(nl,{}),document.getElementById("app"));
